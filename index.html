<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>計算テスト (ランダム10問)</title>
    
    <link rel="stylesheet" href="./katex/katex.min.css">
    <script defer src="./katex/katex.min.js"></script>

    <style>
        /* ページの基本スタイル */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            transition: background-color 0.5s ease;
        }
        
        /* タイマー警告時の背景色 */
        body.timer-warning {
            background-color: #ffebee; /* 薄い赤色 */
        }

        /* クイズ全体のコンテナ */
        .quiz-container {
            max-width: 600px;
            width: 90%;
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        /* タイマーのスタイル */
        .timer-container {
            position: relative;
            width: 100%;
            height: 25px;
            background-color: #e9ecef;
            border-radius: 15px;
            margin-bottom: 1.5em;
            overflow: hidden;
        }
        .timer-bar {
            height: 100%;
            width: 100%;
            background-color: #3498db;
            border-radius: 15px;
            transition: width 1s linear, background-color 0.5s ease;
        }
        .timer-bar.warning {
            background-color: #dc3545;
        }
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: bold;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin: 0 0 1em 0;
        }

        .problem-text {
            font-size: 2em;
            margin-bottom: 1em;
            text-align: center;
            min-height: 50px;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .choice {
            display: block;
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            border: 2px solid transparent;
            font-size: 1.2em;
        }
        .choice:hover {
            background-color: #d1d9e0;
        }
        
        .choice.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            color: #155724;
            font-weight: bold;
        }
        .choice.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            color: #721c24;
        }
        .choices.answered {
            pointer-events: none;
        }
        .choices.answered .choice:not(.correct):not(.incorrect) {
            opacity: 0.6;
        }

        .feedback-area {
            margin-top: 1.5em;
            min-height: 150px;
        }
        .feedback-message {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin: 0 0 15px 0;
        }
        .feedback-message.correct-feedback { color: #28a745; }
        .feedback-message.incorrect-feedback { color: #dc3545; }
        
        .calculation-process {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            font-size: 1.1em;
            border-left: 5px solid #6c757d;
        }
        .katex-display {
            text-align: left !important;
        }
        
        .controls { text-align: center; margin-top: 1em; height: 50px; }
        #next-btn {
            padding: 12px 35px;
            font-size: 1.1em;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #next-btn:hover { background-color: #2980b9; }
        
        #results { text-align: center; }
        #results h2 { color: #2c3e50; }
        #results p { font-size: 2em; font-weight: bold; color: #3498db; }
        #results .sub-message { font-size: 1em; color: #6c757d; margin-top: 0.5em;}
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="quiz-container">
        <div class="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
            <span class="timer-text" id="timer-text">30</span>
        </div>
        
        <h1>計算テスト</h1>
        <div id="question-area"></div>
        <div id="results" class="hidden">
            <h2>テスト終了！</h2>
            <p id="score"></p>
            <p class="sub-message">お疲れ様でした！</p>
        </div>
        <div class="controls">
            <button id="next-btn" class="hidden">次の問題へ</button>
        </div>
    </div>

    <script>
        // ===== 全100問の問題データバンク =====
        const fullQuizDataBank = [
    // --- 【1番目が正解の問題】 (25問) ---
    { question: "8 \\times 2 - 5", choices: ["11", "16", "3", "6"], answer: "11", process: "\\begin{aligned} & 8 \\times 2 - 5 \\\\ &= 16 - 5 \\\\ &= 11 \\end{aligned}" },
    { question: "-4 + 6 \\div 2", choices: ["-1", "1", "4", "-4"], answer: "-1", process: "\\begin{aligned} & -4 + 6 \\div 2 \\\\ &= -4 + 3 \\\\ &= -1 \\end{aligned}" },
    { question: "9 - (-3) \\times 2", choices: ["15", "12", "3", "21"], answer: "15", process: "\\begin{aligned} & 9 - (-3) \\times 2 \\\\ &= 9 - (-6) \\\\ &= 9 + 6 \\\\ &= 15 \\end{aligned}" },
    { question: "(-12) \\div 4 + 7", choices: ["4", "-10", "10", "-4"], answer: "4", process: "\\begin{aligned} & (-12) \\div 4 + 7 \\\\ &= -3 + 7 \\\\ &= 4 \\end{aligned}" },
    { question: "5 + (-8) - 2", choices: ["-5", "-1", "15", "-11"], answer: "-5", process: "\\begin{aligned} & 5 + (-8) - 2 \\\\ &= -3 - 2 \\\\ &= -5 \\end{aligned}" },
    { question: "10 \\times 3 - (-4)", choices: ["34", "26", "12", "-34"], answer: "34", process: "\\begin{aligned} & 10 \\times 3 - (-4) \\\\ &= 30 + 4 \\\\ &= 34 \\end{aligned}" },
    { question: "-15 \\div (-3) + 9", choices: ["14", "4", "-14", "-4"], answer: "14", process: "\\begin{aligned} & -15 \\div (-3) + 9 \\\\ &= 5 + 9 \\\\ &= 14 \\end{aligned}" },
    { question: "7 - 3 \\times (-5)", choices: ["22", "-20", "-8", "20"], answer: "22", process: "\\begin{aligned} & 7 - 3 \\times (-5) \\\\ &= 7 - (-15) \\\\ &= 7 + 15 \\\\ &= 22 \\end{aligned}" },
    { question: "-6 - 12 \\div (-2)", choices: ["0", "9", "-9", "-12"], answer: "0", process: "\\begin{aligned} & -6 - 12 \\div (-2) \\\\ &= -6 - (-6) \\\\ &= -6 + 6 \\\\ &= 0 \\end{aligned}" },
    { question: "11 + 4 \\times (-1)", choices: ["7", "15", "-15", "-7"], answer: "7", process: "\\begin{aligned} & 11 + 4 \\times (-1) \\\\ &= 11 - 4 \\\\ &= 7 \\end{aligned}" },
    { question: "3 \\times (-7) + 8", choices: ["-13", "-29", "13", "29"], answer: "-13", process: "\\begin{aligned} & 3 \\times (-7) + 8 \\\\ &= -21 + 8 \\\\ &= -13 \\end{aligned}" },
    { question: "-20 \\div 5 - 3", choices: ["-7", "-1", "1", "7"], answer: "-7", process: "\\begin{aligned} & -20 \\div 5 - 3 \\\\ &= -4 - 3 \\\\ &= -7 \\end{aligned}" },
    { question: "14 - 8 + (-5)", choices: ["1", "11", "17", "-1"], answer: "1", process: "\\begin{aligned} & 14 - 8 + (-5) \\\\ &= 6 - 5 \\\\ &= 1 \\end{aligned}" },
    { question: "-9 \\times 2 + 10", choices: ["-8", "-28", "8", "28"], answer: "-8", process: "\\begin{aligned} & -9 \\times 2 + 10 \\\\ &= -18 + 10 \\\\ &= -8 \\end{aligned}" },
    { question: "18 \\div (-6) - 1", choices: ["-4", "-2", "2", "4"], answer: "-4", process: "\\begin{aligned} & 18 \\div (-6) - 1 \\\\ &= -3 - 1 \\\\ &= -4 \\end{aligned}" },
    { question: "6 - (-5) + 3", choices: ["14", "4", "-2", "8"], answer: "14", process: "\\begin{aligned} & 6 - (-5) + 3 \\\\ &= 6 + 5 + 3 \\\\ &= 14 \\end{aligned}" },
    { question: "2 \\times (-9) - 4", choices: ["-22", "-14", "14", "22"], answer: "-22", process: "\\begin{aligned} & 2 \\times (-9) - 4 \\\\ &= -18 - 4 \\\\ &= -22 \\end{aligned}" },
    { question: "-24 \\div (-4) + 5", choices: ["11", "1", "-1", "-11"], answer: "11", process: "\\begin{aligned} & -24 \\div (-4) + 5 \\\\ &= 6 + 5 \\\\ &= 11 \\end{aligned}" },
    { question: "1 - 7 \\times 3", choices: ["-20", "-18", "18", "20"], answer: "-20", process: "\\begin{aligned} & 1 - 7 \\times 3 \\\\ &= 1 - 21 \\\\ &= -20 \\end{aligned}" },
    { question: "-10 - (-6) + 2", choices: ["-2", "-14", "18", "-6"], answer: "-2", process: "\\begin{aligned} & -10 - (-6) + 2 \\\\ &= -10 + 6 + 2 \\\\ &= -4 + 2 \\\\ &= -2 \\end{aligned}" },
    { question: "13 + 5 \\times (-2)", choices: ["3", "-36", "-3", "36"], answer: "3", process: "\\begin{aligned} & 13 + 5 \\times (-2) \\\\ &= 13 - 10 \\\\ &= 3 \\end{aligned}" },
    { question: "-30 \\div 6 - 5", choices: ["-10", "0", "10", "-1"], answer: "-10", process: "\\begin{aligned} & -30 \\div 6 - 5 \\\\ &= -5 - 5 \\\\ &= -10 \\end{aligned}" },
    { question: "8 - 14 + 7", choices: ["1", "13", "-13", "-1"], answer: "1", process: "\\begin{aligned} & 8 - 14 + 7 \\\\ &= -6 + 7 \\\\ &= 1 \\end{aligned}" },
    { question: "4 \\times (-6) + 9", choices: ["-15", "-33", "15", "33"], answer: "-15", process: "\\begin{aligned} & 4 \\times (-6) + 9 \\\\ &= -24 + 9 \\\\ &= -15 \\end{aligned}" },
    { question: "21 \\div (-7) - 3", choices: ["-6", "0", "6", "-1"], answer: "-6", process: "\\begin{aligned} & 21 \\div (-7) - 3 \\\\ &= -3 - 3 \\\\ &= -6 \\end{aligned}" },
    // --- 【2番目が正解の問題】 (25問) ---
    { question: "12 - 3 \\times 5", choices: ["45", "-3", "3", "9"], answer: "-3", process: "\\begin{aligned} & 12 - 3 \\times 5 \\\\ &= 12 - 15 \\\\ &= -3 \\end{aligned}" },
    { question: "-7 + 10 \\div (-2)", choices: ["-1.5", "-12", "-2", "12"], answer: "-12", process: "\\begin{aligned} & -7 + 10 \\div (-2) \\\\ &= -7 - 5 \\\\ &= -12 \\end{aligned}" },
    { question: "5 - (-2) \\times 6", choices: ["42", "17", "-7", "7"], answer: "17", process: "\\begin{aligned} & 5 - (-2) \\times 6 \\\\ &= 5 - (-12) \\\\ &= 5 + 12 \\\\ &= 17 \\end{aligned}" },
    { question: "(-14) \\div 2 + 1", choices: ["-6.5", "-6", "6", "8"], answer: "-6", process: "\\begin{aligned} & (-14) \\div 2 + 1 \\\\ &= -7 + 1 \\\\ &= -6 \\end{aligned}" },
    { question: "3 + (-10) - 4", choices: ["-3", "-11", "11", "9"], answer: "-11", process: "\\begin{aligned} & 3 + (-10) - 4 \\\\ &= -7 - 4 \\\\ &= -11 \\end{aligned}" },
    { question: "6 \\times 4 - (-2)", choices: ["12", "26", "22", "36"], answer: "26", process: "\\begin{aligned} & 6 \\times 4 - (-2) \\\\ &= 24 + 2 \\\\ &= 26 \\end{aligned}" },
    { question: "-18 \\div (-6) + 5", choices: ["-8", "8", "2", "-2"], answer: "8", process: "\\begin{aligned} & -18 \\div (-6) + 5 \\\\ &= 3 + 5 \\\\ &= 8 \\end{aligned}" },
    { question: "9 - 2 \\times (-4)", choices: ["-28", "17", "1", "28"], answer: "17", process: "\\begin{aligned} & 9 - 2 \\times (-4) \\\\ &= 9 - (-8) \\\\ &= 9 + 8 \\\\ &= 17 \\end{aligned}" },
    { question: "-8 - 16 \\div (-4)", choices: ["-6", "-4", "12", "6"], answer: "-4", process: "\\begin{aligned} & -8 - 16 \\div (-4) \\\\ &= -8 - (-4) \\\\ &= -8 + 4 \\\\ &= -4 \\end{aligned}" },
    { question: "15 + 6 \\times (-2)", choices: ["-42", "3", "27", "-3"], answer: "3", process: "\\begin{aligned} & 15 + 6 \\times (-2) \\\\ &= 15 - 12 \\\\ &= 3 \\end{aligned}" },
    { question: "4 \\times (-5) + 3", choices: ["-8", "-17", "17", "8"], answer: "-17", process: "\\begin{aligned} & 4 \\times (-5) + 3 \\\\ &= -20 + 3 \\\\ &= -17 \\end{aligned}" },
    { question: "-25 \\div 5 - 5", choices: ["-0", "-10", "0", "10"], answer: "-10", process: "\\begin{aligned} & -25 \\div 5 - 5 \\\\ &= -5 - 5 \\\\ &= -10 \\end{aligned}" },
    { question: "11 - 9 + (-3)", choices: ["-1", "-1", "23", "5"], answer: "-1", process: "\\begin{aligned} & 11 - 9 + (-3) \\\\ &= 2 - 3 \\\\ &= -1 \\end{aligned}" },
    { question: "-7 \\times 3 + 6", choices: ["-27", "-15", "15", "27"], answer: "-15", process: "\\begin{aligned} & -7 \\times 3 + 6 \\\\ &= -21 + 6 \\\\ &= -15 \\end{aligned}" },
    { question: "24 \\div (-8) - 2", choices: ["-1.5", "-5", "5", "1"], answer: "-5", process: "\\begin{aligned} & 24 \\div (-8) - 2 \\\\ &= -3 - 2 \\\\ &= -5 \\end{aligned}" },
    { question: "1 - (-8) + 4", choices: ["-11", "13", "5", "-3"], answer: "13", process: "\\begin{aligned} & 1 - (-8) + 4 \\\\ &= 1 + 8 + 4 \\\\ &= 13 \\end{aligned}" },
    { question: "5 \\times (-6) - 7", choices: ["-65", "-37", "37", "23"], answer: "-37", process: "\\begin{aligned} & 5 \\times (-6) - 7 \\\\ &= -30 - 7 \\\\ &= -37 \\end{aligned}" },
    { question: "-32 \\div (-8) + 3", choices: ["-1", "7", "-7", "1"], answer: "7", process: "\\begin{aligned} & -32 \\div (-8) + 3 \\\\ &= 4 + 3 \\\\ &= 7 \\end{aligned}" },
    { question: "2 - 9 \\times 2", choices: ["-14", "-16", "16", "20"], answer: "-16", process: "\\begin{aligned} & 2 - 9 \\times 2 \\\\ &= 2 - 18 \\\\ &= -16 \\end{aligned}" },
    { question: "-13 - (-5) + 1", choices: ["-17", "-7", "19", "9"], answer: "-7", process: "\\begin{aligned} & -13 - (-5) + 1 \\\\ &= -13 + 5 + 1 \\\\ &= -8 + 1 \\\\ &= -7 \\end{aligned}" },
    { question: "10 + 7 \\times (-1)", choices: ["-17", "3", "-3", "17"], answer: "3", process: "\\begin{aligned} & 10 + 7 \\times (-1) \\\\ &= 10 - 7 \\\\ &= 3 \\end{aligned}" },
    { question: "-40 \\div 8 - 4", choices: ["-1.25", "-9", "9", "1"], answer: "-9", process: "\\begin{aligned} & -40 \\div 8 - 4 \\\\ &= -5 - 4 \\\\ &= -9 \\end{aligned}" },
    { question: "9 - 11 + 6", choices: ["-8", "4", "26", "-4"], answer: "4", process: "\\begin{aligned} & 9 - 11 + 6 \\\\ &= -2 + 6 \\\\ &= 4 \\end{aligned}" },
    { question: "3 \\times (-8) + 5", choices: ["-9", "-19", "19", "39"], answer: "-19", process: "\\begin{aligned} & 3 \\times (-8) + 5 \\\\ &= -24 + 5 \\\\ &= -19 \\end{aligned}" },
    { question: "28 \\div (-4) - 3", choices: ["-2.33", "-10", "10", "4"], answer: "-10", process: "\\begin{aligned} & 28 \\div (-4) - 3 \\\\ &= -7 - 3 \\\\ &= -10 \\end{aligned}" },
    // --- 【3番目が正解の問題】 (25問) ---
    { question: "15 - 5 \\times 2", choices: ["20", "10", "5", "25"], answer: "5", process: "\\begin{aligned} & 15 - 5 \\times 2 \\\\ &= 15 - 10 \\\\ &= 5 \\end{aligned}" },
    { question: "-9 + 12 \\div (-3)", choices: ["-1", "-7", "-13", "1"], answer: "-13", process: "\\begin{aligned} & -9 + 12 \\div (-3) \\\\ &= -9 - 4 \\\\ &= -13 \\end{aligned}" },
    { question: "4 - (-1) \\times 8", choices: ["24", "40", "12", "-4"], answer: "12", process: "\\begin{aligned} & 4 - (-1) \\times 8 \\\\ &= 4 - (-8) \\\\ &= 4 + 8 \\\\ &= 12 \\end{aligned}" },
    { question: "(-16) \\div 2 + 3", choices: ["-5.33", "-11", "-5", "5"], answer: "-5", process: "\\begin{aligned} & (-16) \\div 2 + 3 \\\\ &= -8 + 3 \\\\ &= -5 \\end{aligned}" },
    { question: "2 + (-12) - 5", choices: ["-5", "-9", "-15", "15"], answer: "-15", process: "\\begin{aligned} & 2 + (-12) - 5 \\\\ &= -10 - 5 \\\\ &= -15 \\end{aligned}" },
    { question: "7 \\times 2 - (-8)", choices: ["-42", "6", "22", "-22"], answer: "22", process: "\\begin{aligned} & 7 \\times 2 - (-8) \\\\ &= 14 + 8 \\\\ &= 22 \\end{aligned}" },
    { question: "-21 \\div (-7) + 2", choices: ["-1", "1", "5", "-5"], answer: "5", process: "\\begin{aligned} & -21 \\div (-7) + 2 \\\\ &= 3 + 2 \\\\ &= 5 \\end{aligned}" },
    { question: "8 - 5 \\times (-2)", choices: ["-6", "6", "18", "-18"], answer: "18", process: "\\begin{aligned} & 8 - 5 \\times (-2) \\\\ &= 8 - (-10) \\\\ &= 8 + 10 \\\\ &= 18 \\end{aligned}" },
    { question: "-3 - 24 \\div (-6)", choices: ["4.5", "-7", "1", "7"], answer: "1", process: "\\begin{aligned} & -3 - 24 \\div (-6) \\\\ &= -3 - (-4) \\\\ &= -3 + 4 \\\\ &= 1 \\end{aligned}" },
    { question: "10 + 8 \\times (-1)", choices: ["-18", "18", "2", "-2"], answer: "2", process: "\\begin{aligned} & 10 + 8 \\times (-1) \\\\ &= 10 - 8 \\\\ &= 2 \\end{aligned}" },
    { question: "6 \\times (-4) + 2", choices: ["-12", "12", "-22", "22"], answer: "-22", process: "\\begin{aligned} & 6 \\times (-4) + 2 \\\\ &= -24 + 2 \\\\ &= -22 \\end{aligned}" },
    { question: "-30 \\div 10 - 3", choices: ["-3.33", "0", "-6", "6"], answer: "-6", process: "\\begin{aligned} & -30 \\div 10 - 3 \\\\ &= -3 - 3 \\\\ &= -6 \\end{aligned}" },
    { question: "12 - 7 + (-4)", choices: ["-15", "1", "1", "9"], answer: "1", process: "\\begin{aligned} & 12 - 7 + (-4) \\\\ &= 5 - 4 \\\\ &= 1 \\end{aligned}" },
    { question: "-5 \\times 4 + 8", choices: ["-28", "28", "-12", "12"], answer: "-12", process: "\\begin{aligned} & -5 \\times 4 + 8 \\\\ &= -20 + 8 \\\\ &= -12 \\end{aligned}" },
    { question: "27 \\div (-9) - 2", choices: ["-1", "-3", "-5", "5"], answer: "-5", process: "\\begin{aligned} & 27 \\div (-9) - 2 \\\\ &= -3 - 2 \\\\ &= -5 \\end{aligned}" },
    { question: "3 - (-9) + 1", choices: ["-7", "11", "13", "-5"], answer: "13", process: "\\begin{aligned} & 3 - (-9) + 1 \\\\ &= 3 + 9 + 1 \\\\ &= 13 \\end{aligned}" },
    { question: "4 \\times (-8) - 6", choices: ["-8", "8", "-38", "38"], answer: "-38", process: "\\begin{aligned} & 4 \\times (-8) - 6 \\\\ &= -32 - 6 \\\\ &= -38 \\end{aligned}" },
    { question: "-35 \\div (-5) + 4", choices: ["-3", "3", "11", "-11"], answer: "11", process: "\\begin{aligned} & -35 \\div (-5) + 4 \\\\ &= 7 + 4 \\\\ &= 11 \\end{aligned}" },
    { question: "5 - 6 \\times 3", choices: ["-3", "3", "-13", "13"], answer: "-13", process: "\\begin{aligned} & 5 - 6 \\times 3 \\\\ &= 5 - 18 \\\\ &= -13 \\end{aligned}" },
    { question: "-11 - (-4) + 2", choices: ["-13", "13", "-5", "-9"], answer: "-5", process: "\\begin{aligned} & -11 - (-4) + 2 \\\\ &= -11 + 4 + 2 \\\\ &= -7 + 2 \\\\ &= -5 \\end{aligned}" },
    { question: "14 + 3 \\times (-3)", choices: ["-51", "51", "5", "-5"], answer: "5", process: "\\begin{aligned} & 14 + 3 \\times (-3) \\\\ &= 14 - 9 \\\\ &= 5 \\end{aligned}" },
    { question: "-45 \\div 9 - 5", choices: ["0", "-5", "-10", "10"], answer: "-10", process: "\\begin{aligned} & -45 \\div 9 - 5 \\\\ &= -5 - 5 \\\\ &= -10 \\end{aligned}" },
    { question: "7 - 15 + 9", choices: ["-17", "17", "1", "-1"], answer: "1", process: "\\begin{aligned} & 7 - 15 + 9 \\\\ &= -8 + 9 \\\\ &= 1 \\end{aligned}" },
    { question: "2 \\times (-10) + 6", choices: ["-32", "32", "-14", "14"], answer: "-14", process: "\\begin{aligned} & 2 \\times (-10) + 6 \\\\ &= -20 + 6 \\\\ &= -14 \\end{aligned}" },
    { question: "32 \\div (-8) - 4", choices: ["-4", "4", "-8", "8"], answer: "-8", process: "\\begin{aligned} & 32 \\div (-8) - 4 \\\\ &= -4 - 4 \\\\ &= -8 \\end{aligned}" },
    // --- 【4番目が正解の問題】 (25問) ---
    { question: "20 - 6 \\times 3", choices: ["42", "11", "14", "2"], answer: "2", process: "\\begin{aligned} & 20 - 6 \\times 3 \\\\ &= 20 - 18 \\\\ &= 2 \\end{aligned}" },
    { question: "-8 + 14 \\div (-2)", choices: ["-3", "-11", "3", "-15"], answer: "-15", process: "\\begin{aligned} & -8 + 14 \\div (-2) \\\\ &= -8 - 7 \\\\ &= -15 \\end{aligned}" },
    { question: "3 - (-4) \\times 5", choices: ["-35", "35", "-17", "23"], answer: "23", process: "\\begin{aligned} & 3 - (-4) \\times 5 \\\\ &= 3 - (-20) \\\\ &= 3 + 20 \\\\ &= 23 \\end{aligned}" },
    { question: "(-18) \\div 3 + 5", choices: ["-1", "1", "11", "-1"], answer: "-1", process: "\\begin{aligned} & (-18) \\div 3 + 5 \\\\ &= -6 + 5 \\\\ &= -1 \\end{aligned}" },
    { question: "1 + (-11) - 6", choices: ["-4", "-16", "16", "-16"], answer: "-16", process: "\\begin{aligned} & 1 + (-11) - 6 \\\\ &= -10 - 6 \\\\ &= -16 \\end{aligned}" },
    { question: "8 \\times 3 - (-5)", choices: ["19", "4", "64", "29"], answer: "29", process: "\\begin{aligned} & 8 \\times 3 - (-5) \\\\ &= 24 + 5 \\\\ &= 29 \\end{aligned}" },
    { question: "-24 \\div (-8) + 1", choices: ["-2", "2", "-4", "4"], answer: "4", process: "\\begin{aligned} & -24 \\div (-8) + 1 \\\\ &= 3 + 1 \\\\ &= 4 \\end{aligned}" },
    { question: "6 - 4 \\times (-3)", choices: ["-6", "6", "-18", "18"], answer: "18", process: "\\begin{aligned} & 6 - 4 \\times (-3) \\\\ &= 6 - (-12) \\\\ &= 6 + 12 \\\\ &= 18 \\end{aligned}" },
    { question: "-5 - 30 \\div (-5)", choices: ["7", "-7", "-11", "1"], answer: "1", process: "\\begin{aligned} & -5 - 30 \\div (-5) \\\\ &= -5 - (-6) \\\\ &= -5 + 6 \\\\ &= 1 \\end{aligned}" },
    { question: "12 + 10 \\times (-1)", choices: ["-22", "22", "-2", "2"], answer: "2", process: "\\begin{aligned} & 12 + 10 \\times (-1) \\\\ &= 12 - 10 \\\\ &= 2 \\end{aligned}" },
    { question: "7 \\times (-3) + 4", choices: ["-7", "7", "25", "-17"], answer: "-17", process: "\\begin{aligned} & 7 \\times (-3) + 4 \\\\ &= -21 + 4 \\\\ &= -17 \\end{aligned}" },
    { question: "-35 \\div 7 - 2", choices: ["-3", "3", "7", "-7"], answer: "-7", process: "\\begin{aligned} & -35 \\div 7 - 2 \\\\ &= -5 - 2 \\\\ &= -7 \\end{aligned}" },
    { question: "10 - 6 + (-1)", choices: ["3", "5", "-5", "3"], answer: "3", process: "\\begin{aligned} & 10 - 6 + (-1) \\\\ &= 4 - 1 \\\\ &= 3 \\end{aligned}" },
    { question: "-6 \\times 5 + 2", choices: ["-18", "18", "-40", "-28"], answer: "-28", process: "\\begin{aligned} & -6 \\times 5 + 2 \\\\ &= -30 + 2 \\\\ &= -28 \\end{aligned}" },
    { question: "30 \\div (-5) - 3", choices: ["-3", "3", "9", "-9"], answer: "-9", process: "\\begin{aligned} & 30 \\div (-5) - 3 \\\\ &= -6 - 3 \\\\ &= -9 \\end{aligned}" },
    { question: "2 - (-10) + 3", choices: ["-11", "9", "5", "15"], answer: "15", process: "\\begin{aligned} & 2 - (-10) + 3 \\\\ &= 2 + 10 + 3 \\\\ &= 15 \\end{aligned}" },
    { question: "3 \\times (-9) - 5", choices: ["-12", "12", "42", "-32"], answer: "-32", process: "\\begin{aligned} & 3 \\times (-9) - 5 \\\\ &= -27 - 5 \\\\ &= -32 \\end{aligned}" },
    { question: "-40 \\div (-4) + 6", choices: ["4", "-4", "10", "16"], answer: "16", process: "\\begin{aligned} & -40 \\div (-4) + 6 \\\\ &= 10 + 6 \\\\ &= 16 \\end{aligned}" },
    { question: "4 - 5 \\times 4", choices: ["-4", "4", "36", "-16"], answer: "-16", process: "\\begin{aligned} & 4 - 5 \\times 4 \\\\ &= 4 - 20 \\\\ &= -16 \\end{aligned}" },
    { question: "-15 - (-3) + 2", choices: ["-20", "-14", "20", "-10"], answer: "-10", process: "\\begin{aligned} & -15 - (-3) + 2 \\\\ &= -15 + 3 + 2 \\\\ &= -12 + 2 \\\\ &= -10 \\end{aligned}" },
    { question: "16 + 2 \\times (-5)", choices: ["-70", "70", "-6", "6"], answer: "6", process: "\\begin{aligned} & 16 + 2 \\times (-5) \\\\ &= 16 - 10 \\\\ &= 6 \\end{aligned}" },
    { question: "-50 \\div 10 - 5", choices: ["-1", "1", "0", "-10"], answer: "-10", process: "\\begin{aligned} & -50 \\div 10 - 5 \\\\ &= -5 - 5 \\\\ &= -10 \\end{aligned}" },
    { question: "5 - 12 + 8", choices: ["-15", "15", "-1", "1"], answer: "1", process: "\\begin{aligned} & 5 - 12 + 8 \\\\ &= -7 + 8 \\\\ &= 1 \\end{aligned}" },
    { question: "1 \\times (-12) + 7", choices: ["-5", "19", "20", "-5"], answer: "-5", process: "\\begin{aligned} & 1 \\times (-12) + 7 \\\\ &= -12 + 7 \\\\ &= -5 \\end{aligned}" },
    { question: "36 \\div (-6) - 6", choices: ["0", "12", "-1", "-12"], answer: "-12", process: "\\begin{aligned} & 36 \\div (-6) - 6 \\\\ &= -6 - 6 \\\\ &= -12 \\end{aligned}" }
];
        // ===== 問題をシャッフルして10問選ぶ =====
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        const shuffledData = shuffleArray(fullQuizDataBank);
        const selectedQuizData = shuffledData.slice(0, 10);

        // ===== 変数定義 =====
        const questionArea = document.getElementById('question-area');
        const nextButton = document.getElementById('next-btn');
        const resultsArea = document.getElementById('results');
        const scoreDisplay = document.getElementById('score');
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        
        let currentQuestionIndex = 0;
        let score = 0;
        
        let timerInterval;
        let timeLeft = 15;
        const TIME_LIMIT = 15;

        // ===== タイマー関数 =====
        function startTimer() {
            timeLeft = TIME_LIMIT;
            timerText.textContent = timeLeft;
            timerBar.style.width = '100%';
            timerBar.classList.remove('warning');
            document.body.classList.remove('timer-warning');

            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.textContent = timeLeft;
                timerBar.style.width = (timeLeft / TIME_LIMIT) * 100 + '%';

                if (timeLeft <= 5) {
                    timerBar.classList.add('warning');
                    document.body.classList.add('timer-warning');
                }

                if (timeLeft <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function timeUp() {
            stopTimer();

            const choicesContainer = questionArea.querySelector('.choices');
            const feedbackMessage = document.getElementById('feedback-message');
            const processDisplay = document.getElementById('calculation-process');
            const currentQuestion = selectedQuizData[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;

            if(choicesContainer) {
                choicesContainer.classList.add('answered');
            }

            feedbackMessage.textContent = "時間切れ💦";
            feedbackMessage.classList.add('incorrect-feedback');
            feedbackMessage.classList.remove('hidden');

            katex.render(currentQuestion.process, processDisplay, { throwOnError: false, displayMode: true });
            processDisplay.classList.remove('hidden');

            Array.from(choicesContainer.children).forEach(child => {
                if (child.innerText === correctAnswer) {
                    child.classList.add('correct');
                }
            });

            if (currentQuestionIndex < selectedQuizData.length - 1) {
                nextButton.innerText = "次の問題へ";
            } else {
                nextButton.innerText = "結果を見る";
            }
            nextButton.classList.remove('hidden');
        }

        // ===== クイズ本体の関数 =====
        function showQuestion() {
            const currentQuestion = selectedQuizData[currentQuestionIndex];
            
            const choicesHtml = currentQuestion.choices.map(choice => 
                `<div class="choice" onclick="selectAnswer(this, '${choice}')">${choice}</div>`
            ).join('');

            questionArea.innerHTML = `
                <div class="question-block">
                    <div class="problem-text" id="problem-text"></div>
                    <div class="choices">${choicesHtml}</div>
                    <div class="feedback-area">
                        <p id="feedback-message" class="hidden"></p>
                        <div id="calculation-process" class="calculation-process hidden"></div>
                    </div>
                </div>
            `;
            
            const problemTextElement = document.getElementById('problem-text');
            katex.render(currentQuestion.question, problemTextElement, { throwOnError: false, displayMode: true });
            
            startTimer();
        }

        function selectAnswer(element, selectedChoice) {
            stopTimer();

            const choicesContainer = element.parentElement;
            if (choicesContainer.classList.contains('answered')) return;
            choicesContainer.classList.add('answered');

            const currentQuestion = selectedQuizData[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;
            
            const feedbackMessage = document.getElementById('feedback-message');
            const processDisplay = document.getElementById('calculation-process');

            if (selectedChoice === correctAnswer) {
                score++;
                element.classList.add('correct');
                feedbackMessage.textContent = "正解💐";
                feedbackMessage.classList.add('correct-feedback');
            } else {
                element.classList.add('incorrect');
                feedbackMessage.textContent = "不正解💦";
                feedbackMessage.classList.add('incorrect-feedback');
                
                katex.render(currentQuestion.process, processDisplay, { throwOnError: false, displayMode: true });
                processDisplay.classList.remove('hidden');

                Array.from(choicesContainer.children).forEach(child => {
                    if (child.innerText === correctAnswer) child.classList.add('correct');
                });
            }
            
            feedbackMessage.classList.remove('hidden');
            
            if (currentQuestionIndex < selectedQuizData.length - 1) {
                nextButton.innerText = "次の問題へ";
            } else {
                nextButton.innerText = "結果を見る";
            }
            nextButton.classList.remove('hidden');
        }

        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            document.body.classList.remove('timer-warning');
            if (currentQuestionIndex < selectedQuizData.length) {
                showQuestion();
                nextButton.classList.add('hidden');
            } else {
                showResults();
            }
        });

        function showResults() {
            questionArea.classList.add('hidden');
            nextButton.classList.add('hidden');
            document.querySelector('.timer-container').classList.add('hidden');
            
            const finalScore = score * 10;
            const totalPoints = selectedQuizData.length * 10;

            resultsArea.classList.remove('hidden');
            scoreDisplay.textContent = `${finalScore}点 / ${totalPoints}点満点`;
        }

        // ===== 初期化 =====
        document.addEventListener('DOMContentLoaded', function() {
            showQuestion();
        });
    </script>

</body>
</html>

