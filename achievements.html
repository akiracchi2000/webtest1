<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”æˆçŠ¶æ³ãƒ»ãƒ—ãƒ¬ã‚¤å±¥æ­´</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 3em 0;
            background-color: #f4f7f6;
        }

        .container {
            width: 90%;
            max-width: 700px;
            text-align: center;
        }

        .main-card {
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            margin-bottom: 2em;
        }

        h1 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #34495e;
            text-align: left;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin-top: 0;
        }

        /* ===== é”æˆçŠ¶æ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¤‰æ›´ãƒ»è¿½åŠ ï¼‰ ===== */
        .category-title {
            color: #34495e;
            text-align: left;
            border-bottom: 2px solid #3498db; /* åŒºåˆ‡ã‚Šã‚’æ˜ç¢ºã« */
            padding-bottom: 8px;
            margin-top: 1.5em;
            margin-bottom: 1em;
        }
        .main-card h2:first-of-type {
             margin-top: 0; /* æœ€åˆã®è¦‹å‡ºã—ã¯ä¸Šã®ä½™ç™½ã‚’æ¶ˆã™ */
        }
        
        .achievements-list {
            list-style-type: none;
            padding: 0;
            text-align: left;
            margin: 0 0 2em 0; /* å„ãƒªã‚¹ãƒˆã®ä¸‹ã«ä½™ç™½ */
        }
        .achievements-list li {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }
        .achievement-icon {
            font-size: 1.5em;
            margin-left: 10px;
            vertical-align: middle;
            text-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        /* ===== å±¥æ­´è¡¨ç¤ºã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ===== */
        .history-section {
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            margin-bottom: 2em;
        }
        .history-section ul {
            list-style-type: none;
            padding: 0;
            text-align: left;
            max-height: 300px; 
            overflow-y: auto;
        }
        .history-section li {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 5px solid #6c757d;
        }
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
        }
        .history-item-details {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }
        .clear-history-btn {
            margin-top: 1em;
            padding: 8px 16px;
            font-size: 0.9em;
            color: #fff;
            background-color: #dc3545;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .hidden { display: none; }
        
        /* ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .home-btn {
            display: inline-block;
            margin-top: 2em;
            padding: 10px 25px;
            font-size: 1em;
            text-decoration: none;
            color: #fff;
            background-color: #6c757d;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .home-btn:hover {
            background-color: #5a6268;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="main-card">
            <h1>é”æˆçŠ¶æ³</h1>
            
            <h2 class="category-title">æ­£è² ã®æ•°</h2>
            <ul id="achievements-list-calc" class="achievements-list">
                </ul>
            
            <h2 class="category-title">æ–‡å­—å¼</h2>
            <ul id="achievements-list-algebra" class="achievements-list">
                </ul>
            
            <h2 class="category-title">å¹³æ–¹æ ¹</h2>
            <ul id="achievements-list-root" class="achievements-list">
                </ul>
        </div>
        <div class="history-section">
            <h2>ãƒ—ãƒ¬ã‚¤å±¥æ­´ (æ­£è² ã®æ•°)</h2>
            <ul id="history-list-calc"></ul>
            <button id="clear-history-calc" class="clear-history-btn hidden">å±¥æ­´ã‚’å‰Šé™¤</button>
        </div>
        
        <div class="history-section">
            <h2>ãƒ—ãƒ¬ã‚¤å±¥æ­´ (æ–‡å­—å¼)</h2>
            <ul id="history-list-algebra"></ul>
            <button id="clear-history-algebra" class="clear-history-btn hidden">å±¥æ­´ã‚’å‰Šé™¤</button>
        </div>
        
        <div class="history-section">
            <h2>ãƒ—ãƒ¬ã‚¤å±¥æ­´ (å¹³æ–¹æ ¹)</h2>
            <ul id="history-list-root"></ul>
            <button id="clear-history-root" class="clear-history-btn hidden">å±¥æ­´ã‚’å‰Šé™¤</button>
        </div>

        <a href="./index.html" class="home-btn">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // â˜…â˜…â˜…â˜…â˜…â˜…â˜… é”æˆçŠ¶æ³ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ (åˆ†é‡åˆ¥) â˜…â˜…â˜…â˜…â˜…â˜…â˜…
            const achievements = JSON.parse(localStorage.getItem('quizAchievements')) || {};
            
            // å„ãƒ†ã‚¹ãƒˆã®è¡¨ç¤ºåã€IDã€è¡¨ç¤ºå…ˆã®ãƒªã‚¹ãƒˆIDã‚’å®šç¾©
            const testDetails = [
                // æ­£è² ã®æ•°
                { id: 'test1', name: 'æ­£è² ã®æ•°è¨ˆç®—ï¼ˆåˆç´šï¼‰', listId: 'achievements-list-calc' },
                { id: 'test2', name: 'æ­£è² ã®æ•°è¨ˆç®—ï¼ˆä¸Šç´šï¼‰', listId: 'achievements-list-calc' },
                // æ–‡å­—å¼
                { id: 'test3', name: '1æ¬¡å¼ã®æ•´ç†ï¼ˆåˆç´šï¼‰', listId: 'achievements-list-algebra' },
                { id: 'test4', name: '1æ¬¡å¼ã®æ•´ç†ï¼ˆä¸­ç´šï¼‰', listId: 'achievements-list-algebra' },
                { id: 'test5', name: '1æ¬¡å¼ã®æ•´ç†ï¼ˆä¸Šç´šï¼‰', listId: 'achievements-list-algebra' },
                // å¹³æ–¹æ ¹
                { id: 'test6', name: 'å¹³æ–¹æ ¹ã®è¨ˆç®—ï¼ˆåˆç´šï¼‰', listId: 'achievements-list-root' },
                { id: 'test7', name: 'å¹³æ–¹æ ¹ã®è¨ˆç®—ï¼ˆä¸­ç´šï¼‰', listId: 'achievements-list-root' },
                { id: 'test8', name: 'å¹³æ–¹æ ¹ã®è¨ˆç®—ï¼ˆä¸Šç´šï¼‰', listId: 'achievements-list-root' },
            ];

            testDetails.forEach(test => {
                const targetList = document.getElementById(test.listId);
                if (!targetList) return; // å¯¾è±¡ãƒªã‚¹ãƒˆãŒHTMLã«ãªã‘ã‚Œã°ã‚¹ã‚­ãƒƒãƒ—

                const li = document.createElement('li');
                li.textContent = test.name;
                
                const achievementLevel = achievements[test.id]; // 'musou', 'normal', or undefined

                if (achievementLevel) {
                    let icon = 'â­';
                    if (achievementLevel === 'musou') {
                        icon = 'ğŸ‘‘';
                    }
                    li.innerHTML += `<span class="achievement-icon">${icon}</span>`;
                } else {
                    li.innerHTML += `<span class="achievement-icon" style="color: #ccc;">â€•</span>`; // æœªé”æˆã¯ã‚°ãƒ¬ãƒ¼
                }
                targetList.appendChild(li);
            });


            // â˜…â˜…â˜…â˜…â˜…â˜…â˜… ãƒ—ãƒ¬ã‚¤å±¥æ­´ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ (è¤‡æ•°ã‚«ãƒ†ã‚´ãƒªå¯¾å¿œ) â˜…â˜…â˜…â˜…â˜…â˜…â˜…
            function loadHistory(historyKey, listElementId, buttonElementId) {
                const historyList = document.getElementById(listElementId);
                const clearButton = document.getElementById(buttonElementId);
                
                let history = JSON.parse(localStorage.getItem(historyKey)) || [];

                if (history.length > 0) {
                    clearButton.classList.remove('hidden'); 
                    history.forEach(result => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="history-item-header">
                                <span>${result.score}ç‚¹ / ${result.totalPoints}ç‚¹</span>
                                <span>${result.rank} ãƒ©ãƒ³ã‚¯</span>
                            </div>
                            <div class="history-item-details">
                                è§£ç­”æ™‚é–“: ${result.time}ç§’ | ${result.date}
                            </div>
                        `;
                        historyList.appendChild(li);
                    });
                } else {
                    historyList.innerHTML = '<li>ã¾ã ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
                }

                clearButton.addEventListener('click', function() {
                    if (confirm('æœ¬å½“ã«ã“ã®å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                        localStorage.removeItem(historyKey); 
                        location.reload(); 
                    }
                });
            }
            
            // 3ã¤ã®å±¥æ­´ã‚­ãƒ¼ã§ãã‚Œãã‚Œé–¢æ•°ã‚’å‘¼ã³å‡ºã™
            loadHistory('calcHistory', 'history-list-calc', 'clear-history-calc');
            loadHistory('algebraHistory', 'history-list-algebra', 'clear-history-algebra');
            loadHistory('rootHistory', 'history-list-root', 'clear-history-root');
        });
    </script>

</body>
</html>
