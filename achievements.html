<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>達成状況・プレイ履歴</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 3em 0;
            background-color: #f4f7f6;
        }

        .container {
            width: 90%;
            max-width: 700px;
            text-align: center;
        }

        .main-card {
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            margin-bottom: 2em;
        }

        h1 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #34495e;
            text-align: left;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin-top: 0;
        }

        /* ===== 達成状況のスタイル（変更・追加） ===== */
        .category-title {
            color: #34495e;
            text-align: left;
            border-bottom: 2px solid #3498db; /* 区切りを明確に */
            padding-bottom: 8px;
            margin-top: 1.5em;
            margin-bottom: 1em;
        }
        .main-card h2:first-of-type {
             margin-top: 0; /* 最初の見出しは上の余白を消す */
        }
        
        .achievements-list {
            list-style-type: none;
            padding: 0;
            text-align: left;
            margin: 0 0 2em 0; /* 各リストの下に余白 */
        }
        .achievements-list li {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }
        .achievement-icon {
            font-size: 1.5em;
            margin-left: 10px;
            vertical-align: middle;
            text-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        /* ===== 履歴表示エリアのスタイル ===== */
        .history-section {
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            margin-bottom: 2em;
        }
        .history-section ul {
            list-style-type: none;
            padding: 0;
            text-align: left;
            max-height: 300px; 
            overflow-y: auto;
        }
        .history-section li {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 5px solid #6c757d;
        }
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
        }
        .history-item-details {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }
        .clear-history-btn {
            margin-top: 1em;
            padding: 8px 16px;
            font-size: 0.9em;
            color: #fff;
            background-color: #dc3545;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .hidden { display: none; }
        
        /* トップへ戻るボタン */
        .home-btn {
            display: inline-block;
            margin-top: 2em;
            padding: 10px 25px;
            font-size: 1em;
            text-decoration: none;
            color: #fff;
            background-color: #6c757d;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .home-btn:hover {
            background-color: #5a6268;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="main-card">
            <h1>達成状況</h1>
            
            <h2 class="category-title">正負の数</h2>
            <ul id="achievements-list-calc" class="achievements-list">
                </ul>
            
            <h2 class="category-title">文字式</h2>
            <ul id="achievements-list-algebra" class="achievements-list">
                </ul>
            
            <h2 class="category-title">平方根</h2>
            <ul id="achievements-list-root" class="achievements-list">
                </ul>
        </div>
        <div class="history-section">
            <h2>プレイ履歴 (正負の数)</h2>
            <ul id="history-list-calc"></ul>
            <button id="clear-history-calc" class="clear-history-btn hidden">履歴を削除</button>
        </div>
        
        <div class="history-section">
            <h2>プレイ履歴 (文字式)</h2>
            <ul id="history-list-algebra"></ul>
            <button id="clear-history-algebra" class="clear-history-btn hidden">履歴を削除</button>
        </div>
        
        <div class="history-section">
            <h2>プレイ履歴 (平方根)</h2>
            <ul id="history-list-root"></ul>
            <button id="clear-history-root" class="clear-history-btn hidden">履歴を削除</button>
        </div>

        <a href="./index.html" class="home-btn">トップページに戻る</a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // ★★★★★★★ 達成状況の表示ロジック (分野別) ★★★★★★★
            const achievements = JSON.parse(localStorage.getItem('quizAchievements')) || {};
            
            // 各テストの表示名、ID、表示先のリストIDを定義
            const testDetails = [
                // 正負の数
                { id: 'test1', name: '正負の数計算（初級）', listId: 'achievements-list-calc' },
                { id: 'test2', name: '正負の数計算（上級）', listId: 'achievements-list-calc' },
                // 文字式
                { id: 'test3', name: '1次式の整理（初級）', listId: 'achievements-list-algebra' },
                { id: 'test4', name: '1次式の整理（中級）', listId: 'achievements-list-algebra' },
                { id: 'test5', name: '1次式の整理（上級）', listId: 'achievements-list-algebra' },
                // 平方根
                { id: 'test6', name: '平方根の計算（初級）', listId: 'achievements-list-root' },
                { id: 'test7', name: '平方根の計算（中級）', listId: 'achievements-list-root' },
                { id: 'test8', name: '平方根の計算（上級）', listId: 'achievements-list-root' },
            ];

            testDetails.forEach(test => {
                const targetList = document.getElementById(test.listId);
                if (!targetList) return; // 対象リストがHTMLになければスキップ

                const li = document.createElement('li');
                li.textContent = test.name;
                
                const achievementLevel = achievements[test.id]; // 'musou', 'normal', or undefined

                if (achievementLevel) {
                    let icon = '⭐';
                    if (achievementLevel === 'musou') {
                        icon = '👑';
                    }
                    li.innerHTML += `<span class="achievement-icon">${icon}</span>`;
                } else {
                    li.innerHTML += `<span class="achievement-icon" style="color: #ccc;">―</span>`; // 未達成はグレー
                }
                targetList.appendChild(li);
            });


            // ★★★★★★★ プレイ履歴の表示ロジック (複数カテゴリ対応) ★★★★★★★
            function loadHistory(historyKey, listElementId, buttonElementId) {
                const historyList = document.getElementById(listElementId);
                const clearButton = document.getElementById(buttonElementId);
                
                let history = JSON.parse(localStorage.getItem(historyKey)) || [];

                if (history.length > 0) {
                    clearButton.classList.remove('hidden'); 
                    history.forEach(result => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <div class="history-item-header">
                                <span>${result.score}点 / ${result.totalPoints}点</span>
                                <span>${result.rank} ランク</span>
                            </div>
                            <div class="history-item-details">
                                解答時間: ${result.time}秒 | ${result.date}
                            </div>
                        `;
                        historyList.appendChild(li);
                    });
                } else {
                    historyList.innerHTML = '<li>まだプレイ履歴がありません。</li>';
                }

                clearButton.addEventListener('click', function() {
                    if (confirm('本当にこの履歴をすべて削除しますか？')) {
                        localStorage.removeItem(historyKey); 
                        location.reload(); 
                    }
                });
            }
            
            // 3つの履歴キーでそれぞれ関数を呼び出す
            loadHistory('calcHistory', 'history-list-calc', 'clear-history-calc');
            loadHistory('algebraHistory', 'history-list-algebra', 'clear-history-algebra');
            loadHistory('rootHistory', 'history-list-root', 'clear-history-root');
        });
    </script>

</body>
</html>
