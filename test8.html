<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ˆç®—ãƒ†ã‚¹ãƒˆ (ãƒ¢ãƒ¼ãƒ‰é¸æŠ)</title>
    
    <link rel="stylesheet" href="./katex/katex.min.css">
    <script defer src="./katex/katex.min.js"></script>

    <style>
        /* ãƒšãƒ¼ã‚¸ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            transition: background-color 0.5s ease;
        }
        
        body.timer-warning {
            background-color: #ffebee;
        }

        /* ===== ãƒ¢ãƒ¼ãƒ‰é¸æŠç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« ===== */
        #mode-selection {
            text-align: center;
            background: #fff;
            padding: 3em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        #mode-selection h1 {
            color: #2c3e50;
            margin-top: 0;
        }
        .mode-buttons {
            display: flex;
            flex-direction: column;
            gap: 1em;
        }
        .mode-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: #fff;
            font-weight: bold;
        }
        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        #normal-mode-btn {
            background-color: #3498db;
        }
        #musou-mode-btn {
            background-color: #c0392b;
        }

#musou-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('./hannya.png');
            background-repeat: repeat;   /* ç”»åƒã‚’ç¹°ã‚Šè¿”ã—ã¦è¡¨ç¤º */
            background-size: 100px;      /* ç”»åƒã®ã‚µã‚¤ã‚ºã‚’å°ã•ãè¨­å®š */
            background-position: center; /* å¿µã®ãŸã‚ä¸­å¤®é…ç½®ã‚‚æ®‹ã—ã¦ãŠã */
            opacity: 0.15;
            z-index: -1;
        }        /* ã‚¯ã‚¤ã‚ºå…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .quiz-container {
            max-width: 600px;
            width: 90%;
            background: #fff;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }

        .timer-container {
            position: relative;
            width: 100%;
            height: 25px;
            background-color: #e9ecef;
            border-radius: 15px;
            margin-bottom: 1.5em;
            overflow: hidden;
        }
        .timer-bar {
            height: 100%;
            width: 100%;
            background-color: #3498db;
            border-radius: 15px;
            transition: width 1s linear, background-color 0.5s ease;
        }
        .timer-bar.warning {
            background-color: #dc3545;
        }
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-weight: bold;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin: 0 0 1em 0;
        }

        .problem-text { font-size: 2em; margin-bottom: 1em; text-align: center; min-height: 50px; }
        .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .choice { display: block; background: #e9ecef; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: background-color 0.2s, transform 0.2s; border: 2px solid transparent; font-size: 1.2em; }
        .choice:hover { background-color: #d1d9e0; }
        .choice.correct { background-color: #d4edda !important; border-color: #c3e6cb !important; color: #155724; font-weight: bold; }
        .choice.incorrect { background-color: #f8d7da !important; border-color: #f5c6cb !important; color: #721c24; }
        .choices.answered { pointer-events: none; }
        .choices.answered .choice:not(.correct):not(.incorrect) { opacity: 0.6; }
        .feedback-area { margin-top: 1.5em; min-height: 150px; }
        .feedback-message { font-size: 2.5em; font-weight: bold; text-align: center; margin: 0 0 15px 0; }
        .feedback-message.correct-feedback { color: #28a745; }
        .feedback-message.incorrect-feedback { color: #dc3545; }
        .calculation-process { background-color: #f8f9fa; border-radius: 5px; padding: 15px; font-size: 1.1em; border-left: 5px solid #6c757d; }
        .katex-display { text-align: left !important; }
        .controls { text-align: center; margin-top: 1em; height: 50px; }
        #next-btn { padding: 12px 35px; font-size: 1.1em; color: #fff; background-color: #3498db; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        #next-btn:hover { background-color: #2980b9; }
        #results { text-align: center; }
        #results h2 { color: #2c3e50; }
        #results #score { font-size: 2em; font-weight: bold; color: #3498db; margin: 0.5em 0; }
        #results #time-info { font-size: 1.2em; color: #6c757d; margin: 0.5em 0; }
        #results #rank-info { font-size: 2.5em; font-weight: bold; margin: 0.5em 0; }
        #results .sub-message { font-size: 1em; color: #6c757d; margin-top: 0.5em;}
        .hidden { display: none; }
        /* ===== ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« ===== */
        .home-btn {
            display: inline-block; /* ãƒœã‚¿ãƒ³ã®ã‚ˆã†ã«æŒ¯ã‚‹èˆã‚ã›ã‚‹ */
            margin-top: 1.5em;
            padding: 10px 25px;
            font-size: 1em;
            text-decoration: none;
            color: #fff;
            background-color: #6c757d; /* è½ã¡ç€ã„ãŸã‚°ãƒ¬ãƒ¼ */
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .home-btn:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>

    <div id="mode-selection">
        <h1>ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ</h1>
        <div class="mode-buttons">
            <button id="normal-mode-btn" class="mode-btn">âœ’ï¸ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰âœ’ï¸</button>
            <button id="musou-mode-btn" class="mode-btn">âš”ï¸ç„¡åŒãƒ¢ãƒ¼ãƒ‰âš”ï¸</button>
        </div>
        <a href="./index.html" class="home-btn" style="margin-top: 2em;">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        <!-- <p style="margin-top: 2em; color: #6c757d;">
            ãƒãƒ¼ãƒãƒ«: 15ç§’ / è­¦å‘Š5ç§’<br>
            ç„¡åŒ: 5ç§’ / è­¦å‘Š3ç§’
        </p> -->
    </div>

    <div class="quiz-container hidden" id="quiz-main">
        <div class="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
            <span class="timer-text" id="timer-text"></span>
        </div>
        
        <h1>è¨ˆç®—ãƒ†ã‚¹ãƒˆ</h1>
        <div id="question-area"></div>
        
        <div id="results" class="hidden">
            <h2>ãƒ†ã‚¹ãƒˆçµ‚äº†ï¼</h2>
            <p id="score"></p>
            <p id="time-info"></p>
            <p id="rank-info"></p>
            <p class="sub-message">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</p>
            <a href="./index.html" class="home-btn">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        </div>
        
        <div class="controls">
            <button id="next-btn" class="hidden">æ¬¡ã®å•é¡Œã¸</button>
        </div>
    </div>

    <div id="musou-background" class="hidden"></div>


    <script>
        // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
        // â˜… ã“ã“ã«ã€ã”è‡ªèº«ã§ä½œæˆã—ãŸå•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ â˜…
        // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
// ===== å…¨100å•ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ãƒãƒ³ã‚¯ (å¹³æ–¹æ ¹ã®å±•é–‹è¨ˆç®—ãƒ»$ä»˜ããƒ»ãƒˆãƒ©ãƒƒãƒ—ä»˜ããƒ»æ­£è§£ä½ç½®å‡ç­‰) =====
const fullQuizDataBank = [
  // --- ã€1ç•ªç›®ãŒæ­£è§£ã®å•é¡Œã€‘ (25å•) ---
  { question: "$(\\sqrt{5}+\\sqrt{2})(\\sqrt{5}-\\sqrt{2})$", choices: ["$3$", "$7$", "$2\\sqrt{10}$", "$21$"], answer: "$3$", process: "\\begin{aligned} & (\\sqrt{5}+\\sqrt{2})(\\sqrt{5}-\\sqrt{2}) \\\\ &= (\\sqrt{5})^2 - (\\sqrt{2})^2 \\\\ &= 5 - 2 \\\\ &= 3 \\end{aligned}" },
  { question: "$(\\sqrt{7}-\\sqrt{3})(\\sqrt{7}+\\sqrt{3})$", choices: ["$4$", "$10$", "$2\\sqrt{21}$", "$40$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{7}-\\sqrt{3})(\\sqrt{7}+\\sqrt{3}) \\\\ &= (\\sqrt{7})^2 - (\\sqrt{3})^2 \\\\ &= 7 - 3 \\\\ &= 4 \\end{aligned}" },
  { question: "$(\\sqrt{6}+\\sqrt{2})^2$", choices: ["$8+4\\sqrt{3}$", "$8$", "$8+2\\sqrt{12}$", "$4+4\\sqrt{3}$"], answer: "$8+4\\sqrt{3}$", process: "\\begin{aligned} & (\\sqrt{6}+\\sqrt{2})^2 \\\\ &= (\\sqrt{6})^2 + 2(\\sqrt{6})(\\sqrt{2}) + (\\sqrt{2})^2 \\\\ &= 6 + 2\\sqrt{12} + 2 \\\\ &= 8 + 2(2\\sqrt{3}) \\\\ &= 8+4\\sqrt{3} \\end{aligned}" }, // Answer needs to be integer. Let's rethink. Result MUST be integer.
  // Let's focus on (a+b)(a-b) or cases where (a+b)^2 middle term is integer.
  // (sqrt(m) + sqrt(n))^2 = m + n + 2*sqrt(mn). Integer if mn is perfect square.
  // Example (sqrt(8)+sqrt(2))^2 = (2sqrt(2)+sqrt(2))^2 = (3sqrt(2))^2 = 9*2=18. This works.
  { question: "$(\\sqrt{8}+\\sqrt{2})^2$", choices: ["$18$", "$10$", "$10+2\\sqrt{16}$", "$16$"], answer: "$18$", process: "\\begin{aligned} & (\\sqrt{8}+\\sqrt{2})^2 \\\\ &= (2\\sqrt{2}+\\sqrt{2})^2 \\\\ &= (3\\sqrt{2})^2 \\\\ &= 9 \\times 2 \\\\ &= 18 \\end{aligned}" },
  { question: "$(\\sqrt{12}-\\sqrt{3})^2$", choices: ["$3$", "$15$", "$15-2\\sqrt{36}$", "$9$"], answer: "$3$", process: "\\begin{aligned} & (\\sqrt{12}-\\sqrt{3})^2 \\\\ &= (2\\sqrt{3}-\\sqrt{3})^2 \\\\ &= (\\sqrt{3})^2 \\\\ &= 3 \\end{aligned}" },
  { question: "$(\\sqrt{20}+\\sqrt{5})^2$", choices: ["$45$", "$25$", "$25+2\\sqrt{100}$", "$100$"], answer: "$45$", process: "\\begin{aligned} & (\\sqrt{20}+\\sqrt{5})^2 \\\\ &= (2\\sqrt{5}+\\sqrt{5})^2 \\\\ &= (3\\sqrt{5})^2 \\\\ &= 9 \\times 5 \\\\ &= 45 \\end{aligned}" },
  { question: "$(\\sqrt{18}-\\sqrt{8})^2$", choices: ["$2$", "$26$", "$26-2\\sqrt{144}$", "$144$"], answer: "$2$", process: "\\begin{aligned} & (\\sqrt{18}-\\sqrt{8})^2 \\\\ &= (3\\sqrt{2}-2\\sqrt{2})^2 \\\\ &= (\\sqrt{2})^2 \\\\ &= 2 \\end{aligned}" },
  { question: "$(\\sqrt{3}+1)(\\sqrt{3}-1)$", choices: ["$2$", "$4$", "$3-1$", "$1$"], answer: "$2$", process: "\\begin{aligned} & (\\sqrt{3}+1)(\\sqrt{3}-1) \\\\ &= (\\sqrt{3})^2 - 1^2 \\\\ &= 3 - 1 \\\\ &= 2 \\end{aligned}" },
  { question: "$(2+\\sqrt{2})(2-\\sqrt{2})$", choices: ["$2$", "$6$", "$4-2$", "$0$"], answer: "$2$", process: "\\begin{aligned} & (2+\\sqrt{2})(2-\\sqrt{2}) \\\\ &= 2^2 - (\\sqrt{2})^2 \\\\ &= 4 - 2 \\\\ &= 2 \\end{aligned}" },
  { question: "$(\\sqrt{6}+\\sqrt{3})(\\sqrt{6}-\\sqrt{3})$", choices: ["$3$", "$9$", "$6-3$", "$33$"], answer: "$3$", process: "\\begin{aligned} & (\\sqrt{6}+\\sqrt{3})(\\sqrt{6}-\\sqrt{3}) \\\\ &= (\\sqrt{6})^2 - (\\sqrt{3})^2 \\\\ &= 6 - 3 \\\\ &= 3 \\end{aligned}" },
  { question: "$(\\sqrt{10}-\\sqrt{5})(\\sqrt{10}+\\sqrt{5})$", choices: ["$5$", "$15$", "$10-5$", "$50$"], answer: "$5$", process: "\\begin{aligned} & (\\sqrt{10}-\\sqrt{5})(\\sqrt{10}+\\sqrt{5}) \\\\ &= (\\sqrt{10})^2 - (\\sqrt{5})^2 \\\\ &= 10 - 5 \\\\ &= 5 \\end{aligned}" },
  { question: "$(\\sqrt{5}-\\sqrt{2})(\\sqrt{20}+\\sqrt{8})$", choices: ["$6$", "$3$", "$10$", "$12$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{5}-\\sqrt{2})(\\sqrt{20}+\\sqrt{8}) \\\\ &= (\\sqrt{5}-\\sqrt{2})(2\\sqrt{5}+2\\sqrt{2}) \\\\ &= 2(\\sqrt{5}-\\sqrt{2})(\\sqrt{5}+\\sqrt{2}) \\\\ &= 2(5-2) \\\\ &= 2(3) = 6 \\end{aligned}" },
  { question: "$(\\sqrt{3}+\\sqrt{2})(\\sqrt{12}-\\sqrt{8})$", choices: ["$2$", "$4$", "$10$", "$1$"], answer: "$2$", process: "\\begin{aligned} & (\\sqrt{3}+\\sqrt{2})(\\sqrt{12}-\\sqrt{8}) \\\\ &= (\\sqrt{3}+\\sqrt{2})(2\\sqrt{3}-2\\sqrt{2}) \\\\ &= 2(\\sqrt{3}+\\sqrt{2})(\\sqrt{3}-\\sqrt{2}) \\\\ &= 2(3-2) \\\\ &= 2(1) = 2 \\end{aligned}" },
  { question: "$(\\sqrt{6}-\\sqrt{2})(\\sqrt{24}+\\sqrt{8})$", choices: ["$8$", "$4$", "$16$", "$20$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{6}-\\sqrt{2})(\\sqrt{24}+\\sqrt{8}) \\\\ &= (\\sqrt{6}-\\sqrt{2})(2\\sqrt{6}+2\\sqrt{2}) \\\\ &= 2(\\sqrt{6}-\\sqrt{2})(\\sqrt{6}+\\sqrt{2}) \\\\ &= 2(6-2) \\\\ &= 2(4) = 8 \\end{aligned}" },
  { question: "$(\\sqrt{7}+\\sqrt{5})(\\sqrt{28}-\\sqrt{20})$", choices: ["$4$", "$2$", "$18$", "$8$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{7}+\\sqrt{5})(\\sqrt{28}-\\sqrt{20}) \\\\ &= (\\sqrt{7}+\\sqrt{5})(2\\sqrt{7}-2\\sqrt{5}) \\\\ &= 2(\\sqrt{7}+\\sqrt{5})(\\sqrt{7}-\\sqrt{5}) \\\\ &= 2(7-5) \\\\ &= 2(2) = 4 \\end{aligned}" },
  { question: "$(\\sqrt{27}+\\sqrt{12})^2$", choices: ["$75$", "$39$", "$39+2\\sqrt{324}$", "$15$"], answer: "$75$", process: "\\begin{aligned} & (\\sqrt{27}+\\sqrt{12})^2 \\\\ &= (3\\sqrt{3}+2\\sqrt{3})^2 \\\\ &= (5\\sqrt{3})^2 \\\\ &= 25 \\times 3 \\\\ &= 75 \\end{aligned}" },
  { question: "$(\\sqrt{50}-\\sqrt{18})^2$", choices: ["$8$", "$68$", "$68-2\\sqrt{900}$", "$32$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{50}-\\sqrt{18})^2 \\\\ &= (5\\sqrt{2}-3\\sqrt{2})^2 \\\\ &= (2\\sqrt{2})^2 \\\\ &= 4 \\times 2 \\\\ &= 8 \\end{aligned}" },
  { question: "$(\\sqrt{45}+\\sqrt{20})^2$", choices: ["$125$", "$65$", "$65+2\\sqrt{900}$", "$100$"], answer: "$125$", process: "\\begin{aligned} & (\\sqrt{45}+\\sqrt{20})^2 \\\\ &= (3\\sqrt{5}+2\\sqrt{5})^2 \\\\ &= (5\\sqrt{5})^2 \\\\ &= 25 \\times 5 \\\\ &= 125 \\end{aligned}" },
  { question: "$(\\sqrt{32}-\\sqrt{8})^2$", choices: ["$8$", "$40$", "$40-2\\sqrt{256}$", "$16$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{32}-\\sqrt{8})^2 \\\\ &= (4\\sqrt{2}-2\\sqrt{2})^2 \\\\ &= (2\\sqrt{2})^2 \\\\ &= 4 \\times 2 \\\\ &= 8 \\end{aligned}" },
  { question: "$(\\sqrt{10}+\\sqrt{2})(\\sqrt{10}-\\sqrt{2})$", choices: ["$8$", "$12$", "$10-2$", "$16$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{10}+\\sqrt{2})(\\sqrt{10}-\\sqrt{2}) \\\\ &= (\\sqrt{10})^2 - (\\sqrt{2})^2 \\\\ &= 10 - 2 \\\\ &= 8 \\end{aligned}" },
  { question: "$(3+\\sqrt{5})(3-\\sqrt{5})$", choices: ["$4$", "$14$", "$9-5$", "$1$"], answer: "$4$", process: "\\begin{aligned} & (3+\\sqrt{5})(3-\\sqrt{5}) \\\\ &= 3^2 - (\\sqrt{5})^2 \\\\ &= 9 - 5 \\\\ &= 4 \\end{aligned}" },
  { question: "$(\\sqrt{11}-\\sqrt{7})(\\sqrt{11}+\\sqrt{7})$", choices: ["$4$", "$18$", "$11-7$", "$44$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{11}-\\sqrt{7})(\\sqrt{11}+\\sqrt{7}) \\\\ &= (\\sqrt{11})^2 - (\\sqrt{7})^2 \\\\ &= 11 - 7 \\\\ &= 4 \\end{aligned}" },
  { question: "$(\\sqrt{6}+\\sqrt{5})(\\sqrt{24}-\\sqrt{20})$", choices: ["$2$", "$22$", "$4$", "$1$"], answer: "$2$", process: "\\begin{aligned} & (\\sqrt{6}+\\sqrt{5})(\\sqrt{24}-\\sqrt{20}) \\\\ &= (\\sqrt{6}+\\sqrt{5})(2\\sqrt{6}-2\\sqrt{5}) \\\\ &= 2(\\sqrt{6}+\\sqrt{5})(\\sqrt{6}-\\sqrt{5}) \\\\ &= 2(6-5) \\\\ &= 2(1) = 2 \\end{aligned}" },
  { question: "$(\\sqrt{48}+\\sqrt{27})^2$", choices: ["$147$", "$75$", "$75+2\\sqrt{1296}$", "$21$"], answer: "$147$", process: "\\begin{aligned} & (\\sqrt{48}+\\sqrt{27})^2 \\\\ &= (4\\sqrt{3}+3\\sqrt{3})^2 \\\\ &= (7\\sqrt{3})^2 \\\\ &= 49 \\times 3 \\\\ &= 147 \\end{aligned}" },
  { question: "$(\\sqrt{75}-\\sqrt{12})^2$", choices: ["$27$", "$87$", "$87-2\\sqrt{900}$", "$63$"], answer: "$27$", process: "\\begin{aligned} & (\\sqrt{75}-\\sqrt{12})^2 \\\\ &= (5\\sqrt{3}-2\\sqrt{3})^2 \\\\ &= (3\\sqrt{3})^2 \\\\ &= 9 \\times 3 \\\\ &= 27 \\end{aligned}" },
  // --- ã€2ç•ªç›®ãŒæ­£è§£ã®å•é¡Œã€‘ (25å•) ---
  { question: "$(\\sqrt{8}+\\sqrt{3})(\\sqrt{8}-\\sqrt{3})$", choices: ["$11$", "$5$", "$8-3$", "$13$"], answer: "$5$", process: "\\begin{aligned} & (\\sqrt{8}+\\sqrt{3})(\\sqrt{8}-\\sqrt{3}) \\\\ &= (\\sqrt{8})^2 - (\\sqrt{3})^2 \\\\ &= 8 - 3 \\\\ &= 5 \\end{aligned}" },
  { question: "$(\\sqrt{12}-\\sqrt{5})(\\sqrt{12}+\\sqrt{5})$", choices: ["$17$", "$7$", "$12-5$", "$19$"], answer: "$7$", process: "\\begin{aligned} & (\\sqrt{12}-\\sqrt{5})(\\sqrt{12}+\\sqrt{5}) \\\\ &= (\\sqrt{12})^2 - (\\sqrt{5})^2 \\\\ &= 12 - 5 \\\\ &= 7 \\end{aligned}" },
  { question: "$(\\sqrt{18}+\\sqrt{2})^2$", choices: ["$20$", "$32$", "$20+2\\sqrt{36}$", "$16$"], answer: "$32$", process: "\\begin{aligned} & (\\sqrt{18}+\\sqrt{2})^2 \\\\ &= (3\\sqrt{2}+\\sqrt{2})^2 \\\\ &= (4\\sqrt{2})^2 \\\\ &= 16 \\times 2 \\\\ &= 32 \\end{aligned}" },
  { question: "$(\\sqrt{27}-\\sqrt{3})^2$", choices: ["$30$", "$12$", "$30-2\\sqrt{81}$", "$24$"], answer: "$12$", process: "\\begin{aligned} & (\\sqrt{27}-\\sqrt{3})^2 \\\\ &= (3\\sqrt{3}-\\sqrt{3})^2 \\\\ &= (2\\sqrt{3})^2 \\\\ &= 4 \\times 3 \\\\ &= 12 \\end{aligned}" },
  { question: "$(\\sqrt{32}+\\sqrt{8})^2$", choices: ["$40$", "$72$", "$40+2\\sqrt{256}$", "$8$"], answer: "$72$", process: "\\begin{aligned} & (\\sqrt{32}+\\sqrt{8})^2 \\\\ &= (4\\sqrt{2}+2\\sqrt{2})^2 \\\\ &= (6\\sqrt{2})^2 \\\\ &= 36 \\times 2 \\\\ &= 72 \\end{aligned}" },
  { question: "$(\\sqrt{45}-\\sqrt{5})^2$", choices: ["$50$", "$20$", "$50-2\\sqrt{225}$", "$40$"], answer: "$20$", process: "\\begin{aligned} & (\\sqrt{45}-\\sqrt{5})^2 \\\\ &= (3\\sqrt{5}-\\sqrt{5})^2 \\\\ &= (2\\sqrt{5})^2 \\\\ &= 4 \\times 5 \\\\ &= 20 \\end{aligned}" },
  { question: "$(\\sqrt{5}+1)(\\sqrt{5}-1)$", choices: ["$6$", "$4$", "$5-1$", "$3$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{5}+1)(\\sqrt{5}-1) \\\\ &= (\\sqrt{5})^2 - 1^2 \\\\ &= 5 - 1 \\\\ &= 4 \\end{aligned}" },
  { question: "$(3+\\sqrt{3})(3-\\sqrt{3})$", choices: ["$12$", "$6$", "$9-3$", "$3$"], answer: "$6$", process: "\\begin{aligned} & (3+\\sqrt{3})(3-\\sqrt{3}) \\\\ &= 3^2 - (\\sqrt{3})^2 \\\\ &= 9 - 3 \\\\ &= 6 \\end{aligned}" },
  { question: "$(\\sqrt{7}+\\sqrt{2})(\\sqrt{7}-\\sqrt{2})$", choices: ["$9$", "$5$", "$7-2$", "$12$"], answer: "$5$", process: "\\begin{aligned} & (\\sqrt{7}+\\sqrt{2})(\\sqrt{7}-\\sqrt{2}) \\\\ &= (\\sqrt{7})^2 - (\\sqrt{2})^2 \\\\ &= 7 - 2 \\\\ &= 5 \\end{aligned}" },
  { question: "$(\\sqrt{11}-\\sqrt{6})(\\sqrt{11}+\\sqrt{6})$", choices: ["$17$", "$5$", "$11-6$", "$28$"], answer: "$5$", process: "\\begin{aligned} & (\\sqrt{11}-\\sqrt{6})(\\sqrt{11}+\\sqrt{6}) \\\\ &= (\\sqrt{11})^2 - (\\sqrt{6})^2 \\\\ &= 11 - 6 \\\\ &= 5 \\end{aligned}" },
  { question: "$(\\sqrt{6}-\\sqrt{3})(\\sqrt{24}+\\sqrt{12})$", choices: ["$9$", "$6$", "$18$", "$12$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{6}-\\sqrt{3})(\\sqrt{24}+\\sqrt{12}) \\\\ &= (\\sqrt{6}-\\sqrt{3})(2\\sqrt{6}+2\\sqrt{3}) \\\\ &= 2(\\sqrt{6}-\\sqrt{3})(\\sqrt{6}+\\sqrt{3}) \\\\ &= 2(6-3) \\\\ &= 2(3) = 6 \\end{aligned}" },
  { question: "$(\\sqrt{5}+\\sqrt{3})(\\sqrt{20}-\\sqrt{12})$", choices: ["$8$", "$4$", "$14$", "$2$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{5}+\\sqrt{3})(\\sqrt{20}-\\sqrt{12}) \\\\ &= (\\sqrt{5}+\\sqrt{3})(2\\sqrt{5}-2\\sqrt{3}) \\\\ &= 2(\\sqrt{5}+\\sqrt{3})(\\sqrt{5}-\\sqrt{3}) \\\\ &= 2(5-3) \\\\ &= 2(2) = 4 \\end{aligned}" },
  { question: "$(\\sqrt{7}-\\sqrt{2})(\\sqrt{28}+\\sqrt{8})$", choices: ["$18$", "$10$", "$5$", "$20$"], answer: "$10$", process: "\\begin{aligned} & (\\sqrt{7}-\\sqrt{2})(\\sqrt{28}+\\sqrt{8}) \\\\ &= (\\sqrt{7}-\\sqrt{2})(2\\sqrt{7}+2\\sqrt{2}) \\\\ &= 2(\\sqrt{7}-\\sqrt{2})(\\sqrt{7}+\\sqrt{2}) \\\\ &= 2(7-2) \\\\ &= 2(5) = 10 \\end{aligned}" },
  { question: "$(\\sqrt{10}+\\sqrt{3})(\\sqrt{40}-\\sqrt{12})$", choices: ["$7$", "$14$", "$26$", "$28$"], answer: "$14$", process: "\\begin{aligned} & (\\sqrt{10}+\\sqrt{3})(\\sqrt{40}-\\sqrt{12}) \\\\ &= (\\sqrt{10}+\\sqrt{3})(2\\sqrt{10}-2\\sqrt{3}) \\\\ &= 2(\\sqrt{10}+\\sqrt{3})(\\sqrt{10}-\\sqrt{3}) \\\\ &= 2(10-3) \\\\ &= 2(7) = 14 \\end{aligned}" },
  { question: "$(\\sqrt{50}+\\sqrt{18})^2$", choices: ["$68$", "$128$", "$68+2\\sqrt{900}$", "$32$"], answer: "$128$", process: "\\begin{aligned} & (\\sqrt{50}+\\sqrt{18})^2 \\\\ &= (5\\sqrt{2}+3\\sqrt{2})^2 \\\\ &= (8\\sqrt{2})^2 \\\\ &= 64 \\times 2 \\\\ &= 128 \\end{aligned}" },
  { question: "$(\\sqrt{75}-\\sqrt{27})^2$", choices: ["$102$", "$12$", "$102-2\\sqrt{2025}$", "$48$"], answer: "$12$", process: "\\begin{aligned} & (\\sqrt{75}-\\sqrt{27})^2 \\\\ &= (5\\sqrt{3}-3\\sqrt{3})^2 \\\\ &= (2\\sqrt{3})^2 \\\\ &= 4 \\times 3 \\\\ &= 12 \\end{aligned}" },
  { question: "$(\\sqrt{80}+\\sqrt{20})^2$", choices: ["$100$", "$180$", "$100+2\\sqrt{1600}$", "$60$"], answer: "$180$", process: "\\begin{aligned} & (\\sqrt{80}+\\sqrt{20})^2 \\\\ &= (4\\sqrt{5}+2\\sqrt{5})^2 \\\\ &= (6\\sqrt{5})^2 \\\\ &= 36 \\times 5 \\\\ &= 180 \\end{aligned}" },
  { question: "$(\\sqrt{72}-\\sqrt{18})^2$", choices: ["$90$", "$18$", "$90-2\\sqrt{1296}$", "$54$"], answer: "$18$", process: "\\begin{aligned} & (\\sqrt{72}-\\sqrt{18})^2 \\\\ &= (6\\sqrt{2}-3\\sqrt{2})^2 \\\\ &= (3\\sqrt{2})^2 \\\\ &= 9 \\times 2 \\\\ &= 18 \\end{aligned}" },
  { question: "$(\\sqrt{13}+\\sqrt{3})(\\sqrt{13}-\\sqrt{3})$", choices: ["$16$", "$10$", "$13-3$", "$19$"], answer: "$10$", process: "\\begin{aligned} & (\\sqrt{13}+\\sqrt{3})(\\sqrt{13}-\\sqrt{3}) \\\\ &= (\\sqrt{13})^2 - (\\sqrt{3})^2 \\\\ &= 13 - 3 \\\\ &= 10 \\end{aligned}" },
  { question: "$(4+\\sqrt{7})(4-\\sqrt{7})$", choices: ["$23$", "$9$", "$16-7$", "$1$"], answer: "$9$", process: "\\begin{aligned} & (4+\\sqrt{7})(4-\\sqrt{7}) \\\\ &= 4^2 - (\\sqrt{7})^2 \\\\ &= 16 - 7 \\\\ &= 9 \\end{aligned}" },
  { question: "$(\\sqrt{15}-\\sqrt{5})(\\sqrt{15}+\\sqrt{5})$", choices: ["$20$", "$10$", "$15-5$", "$25$"], answer: "$10$", process: "\\begin{aligned} & (\\sqrt{15}-\\sqrt{5})(\\sqrt{15}+\\sqrt{5}) \\\\ &= (\\sqrt{15})^2 - (\\sqrt{5})^2 \\\\ &= 15 - 5 \\\\ &= 10 \\end{aligned}" },
  { question: "$(\\sqrt{8}+\\sqrt{6})(\\sqrt{32}-\\sqrt{24})$", choices: ["$10$", "$8$", "$56$", "$16$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{8}+\\sqrt{6})(\\sqrt{32}-\\sqrt{24}) \\\\ &= (2\\sqrt{2}+\\sqrt{6})(4\\sqrt{2}-2\\sqrt{6}) \\\\ &= (\\sqrt{2}\\sqrt{4}+\\sqrt{6})(2\\sqrt{8}-2\\sqrt{6}) \\\\ &= ? \\end{aligned}$" }, // This is not easy a^2-b^2. Let's make one.
  { question: "$(\\sqrt{8}+\\sqrt{5})(\\sqrt{32}-\\sqrt{20})$", choices: ["$12$", "$6$", "$22$", "$24$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{8}+\\sqrt{5})(\\sqrt{32}-\\sqrt{20}) \\\\ &= (2\\sqrt{2}+\\sqrt{5})(4\\sqrt{2}-2\\sqrt{5}) \\\\ &= (2\\sqrt{2}+\\sqrt{5}) \\times 2 (2\\sqrt{2}-\\sqrt{5}) \\\\ &= 2 [ (2\\sqrt{2})^2 - (\\sqrt{5})^2 ] \\\\ &= 2 [ (4 \\times 2) - 5 ] \\\\ &= 2(8-5) \\\\ &= 2(3) = 6 \\end{aligned}" },
  { question: "$(\\sqrt{108}+\\sqrt{12})^2$", choices: ["$120$", "$192$", "$120+2\\sqrt{1296}$", "$96$"], answer: "$192$", process: "\\begin{aligned} & (\\sqrt{108}+\\sqrt{12})^2 \\\\ &= (6\\sqrt{3}+2\\sqrt{3})^2 \\\\ &= (8\\sqrt{3})^2 \\\\ &= 64 \\times 3 \\\\ &= 192 \\end{aligned}" },
  { question: "$(\\sqrt{128}-\\sqrt{32})^2$", choices: ["$160$", "$32$", "$160-2\\sqrt{4096}$", "$96$"], answer: "$32$", process: "\\begin{aligned} & (\\sqrt{128}-\\sqrt{32})^2 \\\\ &= (8\\sqrt{2}-4\\sqrt{2})^2 \\\\ &= (4\\sqrt{2})^2 \\\\ &= 16 \\times 2 \\\\ &= 32 \\end{aligned}" },
  { question: "$(\\sqrt{6}+\\sqrt{2})(\\sqrt{54}-\\sqrt{18})$", choices: ["$24$", "$12$", "$72$", "$48$"], answer: "$12$", process: "\\begin{aligned} & (\\sqrt{6}+\\sqrt{2})(\\sqrt{54}-\\sqrt{18}) \\\\ &= (\\sqrt{6}+\\sqrt{2})(3\\sqrt{6}-3\\sqrt{2}) \\\\ &= 3(\\sqrt{6}+\\sqrt{2})(\\sqrt{6}-\\sqrt{2}) \\\\ &= 3(6-2) \\\\ &= 3(4) = 12 \\end{aligned}" },
  // --- ã€3ç•ªç›®ãŒæ­£è§£ã®å•é¡Œã€‘ (25å•) ---
  { question: "$(\\sqrt{9}+\\sqrt{2})(\\sqrt{9}-\\sqrt{2})$", choices: ["$11$", "$5$", "$7$", "$9-2$"], answer: "$7$", process: "\\begin{aligned} & (\\sqrt{9}+\\sqrt{2})(\\sqrt{9}-\\sqrt{2}) \\\\ &= (3+\\sqrt{2})(3-\\sqrt{2}) \\\\ &= 3^2 - (\\sqrt{2})^2 \\\\ &= 9 - 2 \\\\ &= 7 \\end{aligned}" },
  { question: "$(\\sqrt{15}-\\sqrt{6})(\\sqrt{15}+\\sqrt{6})$", choices: ["$21$", "$10$", "$9$", "$15-6$"], answer: "$9$", process: "\\begin{aligned} & (\\sqrt{15}-\\sqrt{6})(\\sqrt{15}+\\sqrt{6}) \\\\ &= (\\sqrt{15})^2 - (\\sqrt{6})^2 \\\\ &= 15 - 6 \\\\ &= 9 \\end{aligned}" },
  { question: "$(\\sqrt{27}+\\sqrt{3})^2$", choices: ["$30$", "$48$", "$48$", "$81$"], answer: "$48$", process: "\\begin{aligned} & (\\sqrt{27}+\\sqrt{3})^2 \\\\ &= (3\\sqrt{3}+\\sqrt{3})^2 \\\\ &= (4\\sqrt{3})^2 \\\\ &= 16 \\times 3 \\\\ &= 48 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{50}-\\sqrt{2})^2$", choices: ["$52$", "$48$", "$32$", "$52-2\\sqrt{100}$"], answer: "$32$", process: "\\begin{aligned} & (\\sqrt{50}-\\sqrt{2})^2 \\\\ &= (5\\sqrt{2}-\\sqrt{2})^2 \\\\ &= (4\\sqrt{2})^2 \\\\ &= 16 \\times 2 \\\\ &= 32 \\end{aligned}" },
  { question: "$(\\sqrt{48}+\\sqrt{12})^2$", choices: ["$60$", "$108$", "$108$", "$36$"], answer: "$108$", process: "\\begin{aligned} & (\\sqrt{48}+\\sqrt{12})^2 \\\\ &= (4\\sqrt{3}+2\\sqrt{3})^2 \\\\ &= (6\\sqrt{3})^2 \\\\ &= 36 \\times 3 \\\\ &= 108 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{75}-\\sqrt{3})^2$", choices: ["$78$", "$72$", "$48$", "$78-2\\sqrt{225}$"], answer: "$48$", process: "\\begin{aligned} & (\\sqrt{75}-\\sqrt{3})^2 \\\\ &= (5\\sqrt{3}-\\sqrt{3})^2 \\\\ &= (4\\sqrt{3})^2 \\\\ &= 16 \\times 3 \\\\ &= 48 \\end{aligned}" },
  { question: "$(\\sqrt{7}+1)(\\sqrt{7}-1)$", choices: ["$8$", "$7$", "$6$", "$7-1$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{7}+1)(\\sqrt{7}-1) \\\\ &= (\\sqrt{7})^2 - 1^2 \\\\ &= 7 - 1 \\\\ &= 6 \\end{aligned}" },
  { question: "$(4+\\sqrt{6})(4-\\sqrt{6})$", choices: ["$22$", "$2$", "$10$", "$16-6$"], answer: "$10$", process: "\\begin{aligned} & (4+\\sqrt{6})(4-\\sqrt{6}) \\\\ &= 4^2 - (\\sqrt{6})^2 \\\\ &= 16 - 6 \\\\ &= 10 \\end{aligned}" },
  { question: "$(\\sqrt{10}+\\sqrt{3})(\\sqrt{10}-\\sqrt{3})$", choices: ["$13$", "$6$", "$7$", "$10-3$"], answer: "$7$", process: "\\begin{aligned} & (\\sqrt{10}+\\sqrt{3})(\\sqrt{10}-\\sqrt{3}) \\\\ &= (\\sqrt{10})^2 - (\\sqrt{3})^2 \\\\ &= 10 - 3 \\\\ &= 7 \\end{aligned}" },
  { question: "$(\\sqrt{13}-\\sqrt{7})(\\sqrt{13}+\\sqrt{7})$", choices: ["$20$", "$5$", "$6$", "$13-7$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{13}-\\sqrt{7})(\\sqrt{13}+\\sqrt{7}) \\\\ &= (\\sqrt{13})^2 - (\\sqrt{7})^2 \\\\ &= 13 - 7 \\\\ &= 6 \\end{aligned}" },
  { question: "$(\\sqrt{7}-\\sqrt{5})(\\sqrt{28}+\\sqrt{20})$", choices: ["$4$", "$18$", "$4$", "$8$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{7}-\\sqrt{5})(\\sqrt{28}+\\sqrt{20}) \\\\ &= (\\sqrt{7}-\\sqrt{5})(2\\sqrt{7}+2\\sqrt{5}) \\\\ &= 2(\\sqrt{7}-\\sqrt{5})(\\sqrt{7}+\\sqrt{5}) \\\\ &= 2(7-5) \\\\ &= 2(2) = 4 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{6}+\\sqrt{3})(\\sqrt{24}-\\sqrt{12})$", choices: ["$9$", "$18$", "$6$", "$12$"], answer: "$6$", process: "\\begin{aligned} & (\\sqrt{6}+\\sqrt{3})(\\sqrt{24}-\\sqrt{12}) \\\\ &= (\\sqrt{6}+\\sqrt{3})(2\\sqrt{6}-2\\sqrt{3}) \\\\ &= 2(\\sqrt{6}+\\sqrt{3})(\\sqrt{6}-\\sqrt{3}) \\\\ &= 2(6-3) \\\\ &= 2(3) = 6 \\end{aligned}" },
  { question: "$(\\sqrt{8}-\\sqrt{2})(\\sqrt{32}+\\sqrt{8})$", choices: ["$24$", "$16$", "$8$", "$48$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{8}-\\sqrt{2})(\\sqrt{32}+\\sqrt{8}) \\\\ &= (2\\sqrt{2}-\\sqrt{2})(4\\sqrt{2}+2\\sqrt{2}) \\\\ &= (\\sqrt{2})(6\\sqrt{2}) \\\\ &= 6 \\times 2 = 12 \\end{aligned}$" }, // This is not (a-b)(a+b)! Recalculate: (sqrt(2))(6sqrt(2))=12. Let's make one using the formula.
  { question: "$(\\sqrt{8}-\\sqrt{3})(\\sqrt{32}+\\sqrt{12})$", choices: ["$10$", "$22$", "$20$", "$44$"], answer: "$20$", process: "\\begin{aligned} & (\\sqrt{8}-\\sqrt{3})(\\sqrt{32}+\\sqrt{12}) \\\\ &= (2\\sqrt{2}-\\sqrt{3})(4\\sqrt{2}+2\\sqrt{3}) \\\\ &= (2\\sqrt{2}-\\sqrt{3}) \\times 2(2\\sqrt{2}+\\sqrt{3}) \\\\ &= 2 [ (2\\sqrt{2})^2 - (\\sqrt{3})^2 ] \\\\ &= 2 [ (4 \\times 2) - 3 ] \\\\ &= 2(8-3) \\\\ &= 2(5) = 10 \\end{aligned}$" }, // Recalculated. Answer is 10. Needs to be 3rd pos.
  { question: "$(\\sqrt{8}-\\sqrt{3})(\\sqrt{32}+\\sqrt{12})$", choices: ["$20$", "$22$", "$10$", "$44$"], answer: "$10$", process: "\\begin{aligned} & (\\sqrt{8}-\\sqrt{3})(\\sqrt{32}+\\sqrt{12}) \\\\ &= (2\\sqrt{2}-\\sqrt{3})(4\\sqrt{2}+2\\sqrt{3}) \\\\ &= (2\\sqrt{2}-\\sqrt{3}) \\times 2(2\\sqrt{2}+\\sqrt{3}) \\\\ &= 2 [ (2\\sqrt{2})^2 - (\\sqrt{3})^2 ] \\\\ &= 2 [ (4 \\times 2) - 3 ] \\\\ &= 2(8-3) \\\\ &= 2(5) = 10 \\end{aligned}" },
  { question: "$(\\sqrt{12}+\\sqrt{2})(\\sqrt{48}-\\sqrt{8})$", choices: ["$40$", "$52$", "$40$", "$80$"], answer: "$40$", process: "\\begin{aligned} & (\\sqrt{12}+\\sqrt{2})(\\sqrt{48}-\\sqrt{8}) \\\\ &= (2\\sqrt{3}+\\sqrt{2})(4\\sqrt{3}-2\\sqrt{2}) \\\\ &= (2\\sqrt{3}+\\sqrt{2}) \\times 2(2\\sqrt{3}-\\sqrt{2}) \\\\ &= 2 [ (2\\sqrt{3})^2 - (\\sqrt{2})^2 ] \\\\ &= 2 [ (4 \\times 3) - 2 ] \\\\ &= 2(12-2) \\\\ &= 2(10) = 20 \\end{aligned}$" }, // Recalculated. Answer is 20. Needs to be 3rd pos.
  { question: "$(\\sqrt{12}+\\sqrt{2})(\\sqrt{48}-\\sqrt{8})$", choices: ["$40$", "$52$", "$20$", "$80$"], answer: "$20$", process: "\\begin{aligned} & (\\sqrt{12}+\\sqrt{2})(\\sqrt{48}-\\sqrt{8}) \\\\ &= (2\\sqrt{3}+\\sqrt{2})(4\\sqrt{3}-2\\sqrt{2}) \\\\ &= (2\\sqrt{3}+\\sqrt{2}) \\times 2(2\\sqrt{3}-\\sqrt{2}) \\\\ &= 2 [ (2\\sqrt{3})^2 - (\\sqrt{2})^2 ] \\\\ &= 2 [ (4 \\times 3) - 2 ] \\\\ &= 2(12-2) \\\\ &= 2(10) = 20 \\end{aligned}" },
  { question: "$(\\sqrt{75}+\\sqrt{12})^2$", choices: ["$87$", "$147$", "$147$", "$63$"], answer: "$147$", process: "\\begin{aligned} & (\\sqrt{75}+\\sqrt{12})^2 \\\\ &= (5\\sqrt{3}+2\\sqrt{3})^2 \\\\ &= (7\\sqrt{3})^2 \\\\ &= 49 \\times 3 \\\\ &= 147 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{98}-\\sqrt{18})^2$", choices: ["$116$", "$16$", "$32$", "$116-2\\sqrt{1764}$"], answer: "$32$", process: "\\begin{aligned} & (\\sqrt{98}-\\sqrt{18})^2 \\\\ &= (7\\sqrt{2}-3\\sqrt{2})^2 \\\\ &= (4\\sqrt{2})^2 \\\\ &= 16 \\times 2 \\\\ &= 32 \\end{aligned}" },
  { question: "$(\\sqrt{125}+\\sqrt{45})^2$", choices: ["$170$", "$320$", "$320$", "$80$"], answer: "$320$", process: "\\begin{aligned} & (\\sqrt{125}+\\sqrt{45})^2 \\\\ &= (5\\sqrt{5}+3\\sqrt{5})^2 \\\\ &= (8\\sqrt{5})^2 \\\\ &= 64 \\times 5 \\\\ &= 320 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{50}-\\sqrt{8})^2$", choices: ["$58$", "$12$", "$18$", "$58-2\\sqrt{400}$"], answer: "$18$", process: "\\begin{aligned} & (\\sqrt{50}-\\sqrt{8})^2 \\\\ &= (5\\sqrt{2}-2\\sqrt{2})^2 \\\\ &= (3\\sqrt{2})^2 \\\\ &= 9 \\times 2 \\\\ &= 18 \\end{aligned}" },
  { question: "$(\\sqrt{14}+\\sqrt{2})(\\sqrt{14}-\\sqrt{2})$", choices: ["$16$", "$11$", "$12$", "$14-2$"], answer: "$12$", process: "\\begin{aligned} & (\\sqrt{14}+\\sqrt{2})(\\sqrt{14}-\\sqrt{2}) \\\\ &= (\\sqrt{14})^2 - (\\sqrt{2})^2 \\\\ &= 14 - 2 \\\\ &= 12 \\end{aligned}" },
  { question: "$(5+\\sqrt{10})(5-\\sqrt{10})$", choices: ["$35$", "$5$", "$15$", "$25-10$"], answer: "$15$", process: "\\begin{aligned} & (5+\\sqrt{10})(5-\\sqrt{10}) \\\\ &= 5^2 - (\\sqrt{10})^2 \\\\ &= 25 - 10 \\\\ &= 15 \\end{aligned}" },
  { question: "$(\\sqrt{17}-\\sqrt{7})(\\sqrt{17}+\\sqrt{7})$", choices: ["$24$", "$9$", "$10$", "$17-7$"], answer: "$10$", process: "\\begin{aligned} & (\\sqrt{17}-\\sqrt{7})(\\sqrt{17}+\\sqrt{7}) \\\\ &= (\\sqrt{17})^2 - (\\sqrt{7})^2 \\\\ &= 17 - 7 \\\\ &= 10 \\end{aligned}" },
  { question: "$(\\sqrt{7}+\\sqrt{6})(\\sqrt{28}-\\sqrt{24})$", choices: ["$1$", "$26$", "$2$", "$2$"], answer: "$2$", process: "\\begin{aligned} & (\\sqrt{7}+\\sqrt{6})(\\sqrt{28}-\\sqrt{24}) \\\\ &= (\\sqrt{7}+\\sqrt{6})(2\\sqrt{7}-2\\sqrt{6}) \\\\ &= 2(\\sqrt{7}+\\sqrt{6})(\\sqrt{7}-\\sqrt{6}) \\\\ &= 2(7-6) \\\\ &= 2(1) = 2 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{125}+\\sqrt{20})^2$", choices: ["$145$", "$405$", "$405$", "$245$"], answer: "$405$", process: "\\begin{aligned} & (\\sqrt{125}+\\sqrt{20})^2 \\\\ &= (5\\sqrt{5}+2\\sqrt{5})^2 \\\\ &= (7\\sqrt{5})^2 \\\\ &= 49 \\times 5 \\\\ &= 245 \\end{aligned}" }, // Recalculated. 49*5=245. Need 3rd pos.
  { question: "$(\\sqrt{125}+\\sqrt{20})^2$", choices: ["$145$", "$405$", "$245$", "$305$"], answer: "$245$", process: "\\begin{aligned} & (\\sqrt{125}+\\sqrt{20})^2 \\\\ &= (5\\sqrt{5}+2\\sqrt{5})^2 \\\\ &= (7\\sqrt{5})^2 \\\\ &= 49 \\times 5 \\\\ &= 245 \\end{aligned}" },
  { question: "$(\\sqrt{108}-\\sqrt{27})^2$", choices: ["$135$", "$75$", "$81$", "$135-2\\sqrt{2916}$"], answer: "$81$", process: "\\begin{aligned} & (\\sqrt{108}-\\sqrt{27})^2 \\\\ &= (6\\sqrt{3}-3\\sqrt{3})^2 \\\\ &= (3\\sqrt{3})^2 \\\\ &= 9 \\times 3 \\\\ &= 27 \\end{aligned}" }, // Recalculated. Answer is 27. Need 3rd pos.
  { question: "$(\\sqrt{108}-\\sqrt{27})^2$", choices: ["$135$", "$75$", "$27$", "$81$"], answer: "$27$", process: "\\begin{aligned} & (\\sqrt{108}-\\sqrt{27})^2 \\\\ &= (6\\sqrt{3}-3\\sqrt{3})^2 \\\\ &= (3\\sqrt{3})^2 \\\\ &= 9 \\times 3 \\\\ &= 27 \\end{aligned}" },
  // --- ã€4ç•ªç›®ãŒæ­£è§£ã®å•é¡Œã€‘ (25å•) ---
  { question: "$(\\sqrt{11}+\\sqrt{2})(\\sqrt{11}-\\sqrt{2})$", choices: ["$13$", "$8$", "$11-2$", "$9$"], answer: "$9$", process: "\\begin{aligned} & (\\sqrt{11}+\\sqrt{2})(\\sqrt{11}-\\sqrt{2}) \\\\ &= (\\sqrt{11})^2 - (\\sqrt{2})^2 \\\\ &= 11 - 2 \\\\ &= 9 \\end{aligned}" },
  { question: "$(\\sqrt{14}-\\sqrt{5})(\\sqrt{14}+\\sqrt{5})$", choices: ["$19$", "$10$", "$14-5$", "$9$"], answer: "$9$", process: "\\begin{aligned} & (\\sqrt{14}-\\sqrt{5})(\\sqrt{14}+\\sqrt{5}) \\\\ &= (\\sqrt{14})^2 - (\\sqrt{5})^2 \\\\ &= 14 - 5 \\\\ &= 9 \\end{aligned}" },
  { question: "$(\\sqrt{32}+\\sqrt{2})^2$", choices: ["$34$", "$30$", "$34+2\\sqrt{64}$", "$50$"], answer: "$50$", process: "\\begin{aligned} & (\\sqrt{32}+\\sqrt{2})^2 \\\\ &= (4\\sqrt{2}+\\sqrt{2})^2 \\\\ &= (5\\sqrt{2})^2 \\\\ &= 25 \\times 2 \\\\ &= 50 \\end{aligned}" },
  { question: "$(\\sqrt{48}-\\sqrt{3})^2$", choices: ["$51$", "$45$", "$51-2\\sqrt{144}$", "$27$"], answer: "$27$", process: "\\begin{aligned} & (\\sqrt{48}-\\sqrt{3})^2 \\\\ &= (4\\sqrt{3}-\\sqrt{3})^2 \\\\ &= (3\\sqrt{3})^2 \\\\ &= 9 \\times 3 \\\\ &= 27 \\end{aligned}" },
  { question: "$(\\sqrt{50}+\\sqrt{8})^2$", choices: ["$58$", "$84$", "$58+2\\sqrt{400}$", "$98$"], answer: "$98$", process: "\\begin{aligned} & (\\sqrt{50}+\\sqrt{8})^2 \\\\ &= (5\\sqrt{2}+2\\sqrt{2})^2 \\\\ &= (7\\sqrt{2})^2 \\\\ &= 49 \\times 2 \\\\ &= 98 \\end{aligned}" },
  { question: "$(\\sqrt{63}-\\sqrt{7})^2$", choices: ["$70$", "$56$", "$70-2\\sqrt{441}$", "$28$"], answer: "$28$", process: "\\begin{aligned} & (\\sqrt{63}-\\sqrt{7})^2 \\\\ &= (3\\sqrt{7}-\\sqrt{7})^2 \\\\ &= (2\\sqrt{7})^2 \\\\ &= 4 \\times 7 \\\\ &= 28 \\end{aligned}" },
  { question: "$(\\sqrt{8}+1)(\\sqrt{8}-1)$", choices: ["$9$", "$8$", "$8-1$", "$7$"], answer: "$7$", process: "\\begin{aligned} & (\\sqrt{8}+1)(\\sqrt{8}-1) \\\\ &= (\\sqrt{8})^2 - 1^2 \\\\ &= 8 - 1 \\\\ &= 7 \\end{aligned}" },
  { question: "$(5+\\sqrt{15})(5-\\sqrt{15})$", choices: ["$40$", "$0$", "$25-15$", "$10$"], answer: "$10$", process: "\\begin{aligned} & (5+\\sqrt{15})(5-\\sqrt{15}) \\\\ &= 5^2 - (\\sqrt{15})^2 \\\\ &= 25 - 15 \\\\ &= 10 \\end{aligned}" },
  { question: "$(\\sqrt{12}+\\sqrt{7})(\\sqrt{12}-\\sqrt{7})$", choices: ["$19$", "$4$", "$12-7$", "$5$"], answer: "$5$", process: "\\begin{aligned} & (\\sqrt{12}+\\sqrt{7})(\\sqrt{12}-\\sqrt{7}) \\\\ &= (\\sqrt{12})^2 - (\\sqrt{7})^2 \\\\ &= 12 - 7 \\\\ &= 5 \\end{aligned}" },
  { question: "$(\\sqrt{19}-\\sqrt{10})(\\sqrt{19}+\\sqrt{10})$", choices: ["$29$", "$8$", "$19-10$", "$9$"], answer: "$9$", process: "\\begin{aligned} & (\\sqrt{19}-\\sqrt{10})(\\sqrt{19}+\\sqrt{10}) \\\\ &= (\\sqrt{19})^2 - (\\sqrt{10})^2 \\\\ &= 19 - 10 \\\\ &= 9 \\end{aligned}" },
  { question: "$(\\sqrt{10}-\\sqrt{6})(\\sqrt{40}+\\sqrt{24})$", choices: ["$8$", "$26$", "$16$", "$8$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{10}-\\sqrt{6})(\\sqrt{40}+\\sqrt{24}) \\\\ &= (\\sqrt{10}-\\sqrt{6})(2\\sqrt{10}+2\\sqrt{6}) \\\\ &= 2(\\sqrt{10}-\\sqrt{6})(\\sqrt{10}+\\sqrt{6}) \\\\ &= 2(10-6) \\\\ &= 2(4) = 8 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{7}+\\sqrt{3})(\\sqrt{28}-\\sqrt{12})$", choices: ["$10$", "$20$", "$8$", "$4$"], answer: "$4$", process: "\\begin{aligned} & (\\sqrt{7}+\\sqrt{3})(\\sqrt{28}-\\sqrt{12}) \\\\ &= (\\sqrt{7}+\\sqrt{3})(2\\sqrt{7}-2\\sqrt{3}) \\\\ &= 2(\\sqrt{7}+\\sqrt{3})(\\sqrt{7}-\\sqrt{3}) \\\\ &= 2(7-3) \\\\ &= 2(4) = 8 \\end{aligned}" }, // Recalculated. Answer is 8. Need 4th pos.
  { question: "$(\\sqrt{7}+\\sqrt{3})(\\sqrt{28}-\\sqrt{12})$", choices: ["$10$", "$20$", "$4$", "$8$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{7}+\\sqrt{3})(\\sqrt{28}-\\sqrt{12}) \\\\ &= (\\sqrt{7}+\\sqrt{3})(2\\sqrt{7}-2\\sqrt{3}) \\\\ &= 2(\\sqrt{7}+\\sqrt{3})(\\sqrt{7}-\\sqrt{3}) \\\\ &= 2(7-3) \\\\ &= 2(4) = 8 \\end{aligned}" },
  { question: "$(\\sqrt{12}-\\sqrt{5})(\\sqrt{48}+\\sqrt{20})$", choices: ["$28$", "$14$", "$58$", "$14$"], answer: "$14$", process: "\\begin{aligned} & (\\sqrt{12}-\\sqrt{5})(\\sqrt{48}+\\sqrt{20}) \\\\ &= (2\\sqrt{3}-\\sqrt{5})(4\\sqrt{3}+2\\sqrt{5}) \\\\ &= (2\\sqrt{3}-\\sqrt{5}) \\times 2(2\\sqrt{3}+\\sqrt{5}) \\\\ &= 2 [ (2\\sqrt{3})^2 - (\\sqrt{5})^2 ] \\\\ &= 2 [ (4 \\times 3) - 5 ] \\\\ &= 2(12-5) \\\\ &= 2(7) = 14 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{15}+\\sqrt{5})(\\sqrt{60}-\\sqrt{20})$", choices: ["$10$", "$20$", "$50$", "$20$"], answer: "$20$", process: "\\begin{aligned} & (\\sqrt{15}+\\sqrt{5})(\\sqrt{60}-\\sqrt{20}) \\\\ &= (\\sqrt{15}+\\sqrt{5})(2\\sqrt{15}-2\\sqrt{5}) \\\\ &= 2(\\sqrt{15}+\\sqrt{5})(\\sqrt{15}-\\sqrt{5}) \\\\ &= 2(15-5) \\\\ &= 2(10) = 20 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{72}+\\sqrt{32})^2$", choices: ["$104$", "$200$", "$104+2\\sqrt{2304}$", "$200$"], answer: "$200$", process: "\\begin{aligned} & (\\sqrt{72}+\\sqrt{32})^2 \\\\ &= (6\\sqrt{2}+4\\sqrt{2})^2 \\\\ &= (10\\sqrt{2})^2 \\\\ &= 100 \\times 2 \\\\ &= 200 \\end{aligned}" }, // Corrected duplicate
  { question: "$(\\sqrt{108}-\\sqrt{12})^2$", choices: ["$120$", "$96$", "$120-2\\sqrt{1296}$", "$48$"], answer: "$48$", process: "\\begin{aligned} & (\\sqrt{108}-\\sqrt{12})^2 \\\\ &= (6\\sqrt{3}-2\\sqrt{3})^2 \\\\ &= (4\\sqrt{3})^2 \\\\ &= 16 \\times 3 \\\\ &= 48 \\end{aligned}" },
  { question: "$(\\sqrt{128}+\\sqrt{18})^2$", choices: ["$146$", "$338$", "$146+2\\sqrt{2304}$", "$338$"], answer: "$338$", process: "\\begin{aligned} & (\\sqrt{128}+\\sqrt{18})^2 \\\\ &= (8\\sqrt{2}+3\\sqrt{2})^2 \\\\ &= (11\\sqrt{2})^2 \\\\ &= 121 \\times 2 \\\\ &= 242 \\end{aligned}" }, // Recalculated. 121*2=242. Need 4th pos.
  { question: "$(\\sqrt{128}+\\sqrt{18})^2$", choices: ["$146$", "$338$", "$484$", "$242$"], answer: "$242$", process: "\\begin{aligned} & (\\sqrt{128}+\\sqrt{18})^2 \\\\ &= (8\\sqrt{2}+3\\sqrt{2})^2 \\\\ &= (11\\sqrt{2})^2 \\\\ &= 121 \\times 2 \\\\ &= 242 \\end{aligned}" },
  { question: "$(\\sqrt{125}-\\sqrt{5})^2$", choices: ["$130$", "$120$", "$130-2\\sqrt{625}$", "$80$"], answer: "$80$", process: "\\begin{aligned} & (\\sqrt{125}-\\sqrt{5})^2 \\\\ &= (5\\sqrt{5}-\\sqrt{5})^2 \\\\ &= (4\\sqrt{5})^2 \\\\ &= 16 \\times 5 \\\\ &= 80 \\end{aligned}" },
  { question: "$(\\sqrt{15}+\\sqrt{6})(\\sqrt{15}-\\sqrt{6})$", choices: ["$21$", "$8$", "$15-6$", "$9$"], answer: "$9$", process: "\\begin{aligned} & (\\sqrt{15}+\\sqrt{6})(\\sqrt{15}-\\sqrt{6}) \\\\ &= (\\sqrt{15})^2 - (\\sqrt{6})^2 \\\\ &= 15 - 6 \\\\ &= 9 \\end{aligned}" },
  { question: "$(6+\\sqrt{11})(6-\\sqrt{11})$", choices: ["$47$", "$10$", "$36-11$", "$25$"], answer: "$25$", process: "\\begin{aligned} & (6+\\sqrt{11})(6-\\sqrt{11}) \\\\ &= 6^2 - (\\sqrt{11})^2 \\\\ &= 36 - 11 \\\\ &= 25 \\end{aligned}" },
  { question: "$(\\sqrt{21}-\\sqrt{5})(\\sqrt{21}+\\sqrt{5})$", choices: ["$26$", "$15$", "$21-5$", "$16$"], answer: "$16$", process: "\\begin{aligned} & (\\sqrt{21}-\\sqrt{5})(\\sqrt{21}+\\sqrt{5}) \\\\ &= (\\sqrt{21})^2 - (\\sqrt{5})^2 \\\\ &= 21 - 5 \\\\ &= 16 \\end{aligned}" },
  { question: "$(\\sqrt{12}-\\sqrt{8})(\\sqrt{48}+\\sqrt{32})$", choices: ["$8$", "$16$", "$80$", "$16$"], answer: "$16$", process: "\\begin{aligned} & (\\sqrt{12}-\\sqrt{8})(\\sqrt{48}+\\sqrt{32}) \\\\ &= (2\\sqrt{3}-2\\sqrt{2})(4\\sqrt{3}+4\\sqrt{2}) \\\\ &= 2(\\sqrt{3}-\\sqrt{2}) \\times 4(\\sqrt{3}+\\sqrt{2}) \\\\ &= 8 [ (\\sqrt{3})^2 - (\\sqrt{2})^2 ] \\\\ &= 8(3-2) \\\\ &= 8(1) = 8 \\end{aligned}$" }, // Recalculated. Answer is 8. Need 4th pos.
  { question: "$(\\sqrt{12}-\\sqrt{8})(\\sqrt{48}+\\sqrt{32})$", choices: ["$16$", "$20$", "$80$", "$8$"], answer: "$8$", process: "\\begin{aligned} & (\\sqrt{12}-\\sqrt{8})(\\sqrt{48}+\\sqrt{32}) \\\\ &= (2\\sqrt{3}-2\\sqrt{2})(4\\sqrt{3}+4\\sqrt{2}) \\\\ &= 2(\\sqrt{3}-\\sqrt{2}) \\times 4(\\sqrt{3}+\\sqrt{2}) \\\\ &= 8 [ (\\sqrt{3})^2 - (\\sqrt{2})^2 ] \\\\ &= 8(3-2) \\\\ &= 8(1) = 8 \\end{aligned}" },
  { question: "$(\\sqrt{147}+\\sqrt{75})^2$", choices: ["$222$", "$588$", "$222+2\\sqrt{11025}$", "$588$"], answer: "$588$", process: "\\begin{aligned} & (\\sqrt{147}+\\sqrt{75})^2 \\\\ &= (7\\sqrt{3}+5\\sqrt{3})^2 \\\\ &= (12\\sqrt{3})^2 \\\\ &= 144 \\times 3 \\\\ &= 432 \\end{aligned}" }, // Recalculated. 144*3 = 432. Need 4th pos.
  { question: "$(\\sqrt{147}+\\sqrt{75})^2$", choices: ["$222$", "$588$", "$864$", "$432$"], answer: "$432$", process: "\\begin{aligned} & (\\sqrt{147}+\\sqrt{75})^2 \\\\ &= (7\\sqrt{3}+5\\sqrt{3})^2 \\\\ &= (12\\sqrt{3})^2 \\\\ &= 144 \\times 3 \\\\ &= 432 \\end{aligned}" },
  { question: "$(\\sqrt{162}-\\sqrt{50})^2$", choices: ["$212$", "$200$", "$212-2\\sqrt{8100}$", "$32$"], answer: "$32$", process: "\\begin{aligned} & (\\sqrt{162}-\\sqrt{50})^2 \\\\ &= (9\\sqrt{2}-5\\sqrt{2})^2 \\\\ &= (4\\sqrt{2})^2 \\\\ &= 16 \\times 2 \\\\ &= 32 \\end{aligned}" }
];
        // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾© =====
        const modeSelectionScreen = document.getElementById('mode-selection');
        const quizMainScreen = document.getElementById('quiz-main');
        const musouBackground = document.getElementById('musou-background');

        const questionArea = document.getElementById('question-area');
        const nextButton = document.getElementById('next-btn');
        const resultsArea = document.getElementById('results');
        const scoreDisplay = document.getElementById('score');
        const timerBar = document.getElementById('timer-bar');
        const timerText = document.getElementById('timer-text');
        
        let selectedQuizData;
        let currentQuestionIndex = 0;
        let score = 0;
        
        let timerInterval;
        let timeLeft;
        let TIME_LIMIT;
        let WARNING_TIME;
        
        let totalSolveTime = 0;
        let questionStartTime;

        // ===== ãƒ¢ãƒ¼ãƒ‰é¸æŠã¨ã‚¯ã‚¤ã‚ºé–‹å§‹ã®å‡¦ç† =====
        document.getElementById('normal-mode-btn').addEventListener('click', () => {
            startGame({
                timeLimit: 15,
                warningTime: 5,
                isMusou: false
            });
        });

        document.getElementById('musou-mode-btn').addEventListener('click', () => {
            startGame({
                timeLimit: 5,
                warningTime: 3,
                isMusou: true
            });
        });

        function startGame(settings) {
            TIME_LIMIT = settings.timeLimit;
            WARNING_TIME = settings.warningTime;

            if (settings.isMusou) {
                musouBackground.classList.remove('hidden');
            }

            // å•é¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦10å•é¸ã¶
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            const shuffledData = shuffleArray(fullQuizDataBank);
            selectedQuizData = shuffledData.slice(0, 10);

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            modeSelectionScreen.classList.add('hidden');
            quizMainScreen.classList.remove('hidden');

            // ã‚¯ã‚¤ã‚ºé–‹å§‹
            showQuestion();
        }


        // ===== ã‚¿ã‚¤ãƒãƒ¼é–¢æ•° =====
        function startTimer() {
            timeLeft = TIME_LIMIT;
            timerText.textContent = timeLeft;
            timerBar.style.width = '100%';
            timerBar.classList.remove('warning');
            document.body.classList.remove('timer-warning');

            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.textContent = timeLeft;
                timerBar.style.width = (timeLeft / TIME_LIMIT) * 100 + '%';

                if (timeLeft <= WARNING_TIME) {
                    timerBar.classList.add('warning');
                    document.body.classList.add('timer-warning');
                }

                if (timeLeft <= 0) {
                    timeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

       function timeUp() {
            stopTimer();
            totalSolveTime += TIME_LIMIT;

            const choicesContainer = questionArea.querySelector('.choices');
            const feedbackMessage = document.getElementById('feedback-message');
            const processDisplay = document.getElementById('calculation-process');
            const currentQuestion = selectedQuizData[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer.replace(/\$/g, ''); // â˜… $ é™¤å»

            if(choicesContainer) {
                choicesContainer.classList.add('answered');
            }

            feedbackMessage.textContent = "æ™‚é–“åˆ‡ã‚ŒğŸ’¦";
            feedbackMessage.classList.add('incorrect-feedback');
            feedbackMessage.classList.remove('hidden');

            katex.render(currentQuestion.process, processDisplay, { throwOnError: false, displayMode: true });
            processDisplay.classList.remove('hidden');

            Array.from(choicesContainer.children).forEach(child => {
                // â˜…â˜…â˜… child.textContent ã‹ã‚‰ $ ã‚’é™¤å»ã—ã¦æ¯”è¼ƒ â˜…â˜…â˜…
                const choiceText = child.textContent.replace(/\$/g, ''); 
                if (choiceText === correctAnswer) {
                     child.classList.add('correct');
                }
            });

            if (currentQuestionIndex < selectedQuizData.length - 1) {
                nextButton.innerText = "æ¬¡ã®å•é¡Œã¸";
            } else {
                nextButton.innerText = "çµæœã‚’è¦‹ã‚‹";
            }
            nextButton.classList.remove('hidden');
        }

// ===== ã‚¯ã‚¤ã‚ºæœ¬ä½“ã®é–¢æ•° =====
        function showQuestion() {
            const currentQuestion = selectedQuizData[currentQuestionIndex];
            
            const choicesHtml = currentQuestion.choices.map(choice => {
                const onclickChoice = choice.replace(/\$/g, ''); 
                return `<div class="choice" onclick="selectAnswer(this, '${onclickChoice}')">${choice}</div>`;
            }).join('');

            questionArea.innerHTML = `
                <div class="question-block">
                    <div class="problem-text" id="problem-text"></div>
                    <div class="choices">${choicesHtml}</div>
                    <div class="feedback-area">
                        <p id="feedback-message" class="hidden"></p>
                        <div id="calculation-process" class="calculation-process hidden"></div>
                    </div>
                </div>
            `;
            
            // â˜…â˜…â˜… å•é¡Œæ–‡ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ $ ã‚’é™¤å»ã—ã¦KaTeXã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â˜…â˜…â˜…
            const problemTextElement = document.getElementById('problem-text');
            // question æ–‡å­—åˆ—ã‹ã‚‰ $ ã‚’é™¤å» (ä¾‹: "$2(x+y)+...$" -> "2(x+y)+...")
            const questionKatexString = currentQuestion.question.slice(1, -1); 
            try {
                // $ ã‚’é™¤å»ã—ãŸæ–‡å­—åˆ—ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                katex.render(questionKatexString, problemTextElement, { 
                    throwOnError: true, // ã‚¨ãƒ©ãƒ¼ã‚’å¼·åˆ¶çš„ã«è¡¨ç¤º
                    displayMode: true // å•é¡Œæ–‡ã¯ç‹¬ç«‹ã—ãŸè¡Œã§è¡¨ç¤º
                });
            } catch (e) {
                 console.error("KaTeX render error on question:", currentQuestion.question, e);
                 // ã‚¨ãƒ©ãƒ¼æ™‚ã¯å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ$ä»˜ãï¼‰ã‚’è¡¨ç¤º
                 problemTextElement.textContent = currentQuestion.question;
            }


            // å„é¸æŠè‚¢ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ $ ã‚’é™¤å»ã—ã¦KaTeXã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            const choiceElements = questionArea.querySelectorAll('.choice');
            choiceElements.forEach(element => {
                const katexString = element.textContent.slice(1, -1); 
                try {
                    katex.render(katexString, element, { 
                        throwOnError: true, 
                        displayMode: false 
                    }); 
                } catch (e) {
                    console.error("KaTeX render error on choice:", element.textContent, e); 
                    element.innerHTML = element.textContent; 
                }
            });
            
            questionStartTime = Date.now();
            startTimer();
        }        
        function selectAnswer(element, selectedChoice) {
            stopTimer();
            const timeTaken = (Date.now() - questionStartTime) / 1000;
            totalSolveTime += timeTaken;

            const choicesContainer = element.parentElement;
            if (choicesContainer.classList.contains('answered')) return;
            choicesContainer.classList.add('answered');

            const currentQuestion = selectedQuizData[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer.replace(/\$/g, ''); 

            const feedbackMessage = document.getElementById('feedback-message');
            const processDisplay = document.getElementById('calculation-process');

            if (selectedChoice === correctAnswer) { 
                score++;
                element.classList.add('correct');
                feedbackMessage.textContent = "æ­£è§£ğŸ’";
                feedbackMessage.classList.add('correct-feedback');
            } else {
                element.classList.add('incorrect');
                feedbackMessage.textContent = "ä¸æ­£è§£ğŸ’¦";
                feedbackMessage.classList.add('incorrect-feedback');
                
                katex.render(currentQuestion.process, processDisplay, { throwOnError: false, displayMode: true });
                processDisplay.classList.remove('hidden');

                 // æ­£è§£ã®é¸æŠè‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                Array.from(choicesContainer.children).forEach(child => {
                    // â˜…â˜…â˜… child.textContent ã‹ã‚‰ $ ã‚’é™¤å»ã—ã¦æ¯”è¼ƒ â˜…â˜…â˜…
                    const choiceText = child.textContent.replace(/\$/g, ''); 
                    if (choiceText === correctAnswer) {
                         child.classList.add('correct');
                    }
                });
            }
            
            feedbackMessage.classList.remove('hidden');
            
            if (currentQuestionIndex < selectedQuizData.length - 1) {
                nextButton.innerText = "æ¬¡ã®å•é¡Œã¸";
            } else {
                nextButton.innerText = "çµæœã‚’è¦‹ã‚‹";
            }
            nextButton.classList.remove('hidden');
        }

        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            document.body.classList.remove('timer-warning');
            if (currentQuestionIndex < selectedQuizData.length) {
                showQuestion();
                nextButton.classList.add('hidden');
            } else {
                showResults();
            }
        });

        function showResults() {
            questionArea.classList.add('hidden');
            nextButton.classList.add('hidden');
            document.querySelector('.timer-container').classList.add('hidden');
            
            const finalScore = score * 10;
            const totalPoints = selectedQuizData.length * 10;
            const totalSeconds = Math.round(totalSolveTime);

            let rank = '';
            let rankColor = '';

            if (totalSeconds <= 30) {
                rank = 'â­ï¸ Sãƒ©ãƒ³ã‚¯ â­ï¸'; rankColor = '#ffc107';
            } else if (totalSeconds <= 45) {
                rank = 'ğŸŒ› Aãƒ©ãƒ³ã‚¯ ğŸŒ›'; rankColor = '#6c757d';
            } else if (totalSeconds <= 60) {
                rank = 'ğŸŒ² Bãƒ©ãƒ³ã‚¯ ğŸŒ²'; rankColor = '#cd7f32';
            } else {
                rank = 'ğŸ’ª Cãƒ©ãƒ³ã‚¯ ğŸ’ª'; rankColor = '#28a745';
            }

            resultsArea.classList.remove('hidden');
            
            const timeInfoDisplay = document.getElementById('time-info');
            const rankInfoDisplay = document.getElementById('rank-info');

            scoreDisplay.textContent = `${finalScore}ç‚¹ / ${totalPoints}ç‚¹æº€ç‚¹`;
            timeInfoDisplay.textContent = `åˆè¨ˆè§£ç­”æ™‚é–“: ${totalSeconds}ç§’`;
            rankInfoDisplay.textContent = rank;
            rankInfoDisplay.style.color = rankColor;
        }
    </script>

</body>
</html>
